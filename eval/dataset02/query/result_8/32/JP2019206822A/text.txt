<?xml version="1.0" encoding='utf-8'?>
<!-- <?xml-stylesheet type="text/xsl" href="../../../../../XSL/gat-a.xsl"?> -->
<!DOCTYPE jp-official-gazette PUBLIC "-//JPO//DTD PUBLISHED PATENT/UTILITY MODEL APPLICATION 1.0//EN" "../../../../../DTD/gat-a.dtd">
<jp-official-gazette kind-of-jp="A" kind-of-st16="A" lang="ja" dtd-version="1.0" country="JP" xmlns:jp="http://www.jpo.go.jp"><bibliographic-data lang="ja" country="JP">
    <publication-reference>
      <document-id>
        <country>JP</country>
        <doc-number>2019206822</doc-number>
        <kind>公開特許公報(A)</kind>
        <date>20191205</date>
      </document-id>
    </publication-reference>
    <application-reference>
      <document-id>
        <doc-number>2018101836</doc-number>
        <date>20180528</date>
      </document-id>
    </application-reference>
    <invention-title>制御装置および制御方法</invention-title>
    <parties>
      <jp:applicants-agents-article>
        <jp:applicants-agents sequence="1">
          <applicant sequence="1">
            <addressbook lang="ja">
              <name>株式会社小松製作所</name>
              <registered-number>000001236</registered-number>
              <address>
                <text>東京都港区赤坂二丁目３番６号</text>
              </address>
            </addressbook>
          </applicant>
          <agent sequence="1" jp:kind="representative">
            <addressbook>
              <name>特許業務法人  志賀国際特許事務所</name>
              <registered-number>110001634</registered-number>
            </addressbook>
          </agent>
        </jp:applicants-agents>
      </jp:applicants-agents-article>
      <inventors>
        <inventor sequence="1">
          <addressbook>
            <name>新谷  了</name>
            <address>
              <text>東京都港区赤坂２−３−６  株式会社小松製作所内</text>
            </address>
          </addressbook>
        </inventor>
        <inventor sequence="2">
          <addressbook>
            <name>熊倉  祥人</name>
            <address>
              <text>東京都港区赤坂２−３−６  株式会社小松製作所内</text>
            </address>
          </addressbook>
        </inventor>
        <inventor sequence="3">
          <addressbook>
            <name>有松  大毅</name>
            <address>
              <text>東京都港区赤坂２−３−６  株式会社小松製作所内</text>
            </address>
          </addressbook>
        </inventor>
      </inventors>
    </parties>
    <classification-ipc><edition/><main-clsf>E02F   9/20        20060101AFI20191108BHJP        </main-clsf></classification-ipc>
    <classification-national><country>JP</country><main-clsf>E02F9/20 Q</main-clsf></classification-national>
    <number-of-claims jp:adopted-law="claim">8</number-of-claims>
    <figure-to-publish>
      <fig-number>3</fig-number>
    </figure-to-publish>
    <jp:request-for-examination true-or-false="false"/>
    <jp:filing-form>ＯＬ</jp:filing-form>
    <jp:total-pages>21</jp:total-pages>
    <jp:theme-code-info>
      <jp:theme-code>2D003</jp:theme-code>
    </jp:theme-code-info>
    <jp:f-term-info>
      <jp:f-term>2D003AA01</jp:f-term>
      <jp:f-term>2D003AB04</jp:f-term>
      <jp:f-term>2D003AC06</jp:f-term>
      <jp:f-term>2D003BA01</jp:f-term>
      <jp:f-term>2D003BB02</jp:f-term>
      <jp:f-term>2D003BB03</jp:f-term>
      <jp:f-term>2D003CA02</jp:f-term>
      <jp:f-term>2D003CA10</jp:f-term>
      <jp:f-term>2D003DA04</jp:f-term>
      <jp:f-term>2D003DB01</jp:f-term>
      <jp:f-term>2D003DB05</jp:f-term>
      <jp:f-term>2D003FA02</jp:f-term>
    </jp:f-term-info>
  </bibliographic-data><jp:image-of-bibliographic-data><img id="000001" he="140" wi="160" file="2019206822.tif" img-format="tif" img-content="drawing"/></jp:image-of-bibliographic-data><jp:image-of-chosen-drawing>
    <img id="000002" he="97" wi="68" file="2019206822.tif" img-format="tif" img-content="drawing"/>
  </jp:image-of-chosen-drawing><description>

<technical-field>
<p num="0001">
  本発明は、作業機械の制御装置および制御方法に関する。
</p>
</technical-field>
<background-art>
<p num="0002">
  特許文献１には、バケットの重さの違いによって、作業機を駆動する油圧シリンダに作用する負荷が変化し、掘削精度が低下することを防止する技術が開示されている。具体的には特許文献１によれば、制御装置は、バケットの重量の区分（大、中、または小）の入力を受け付け、シリンダ速度と操作指令値との関係を示す複数の相関データのうち、入力された区分に関連付けられた相関データに基づいて操作指令値を出力する。
</p>
</background-art>
<citation-list>
<patent-literature>
<p num="0003">
<patcit num="1"><text>国際公開第２０１５／１２９９３０号</text></patcit>
</p>
</patent-literature>
</citation-list>
<summary-of-invention>
<tech-problem>
<p num="0004">
  特許文献１に記載の技術においては、バケットの重量の区分を示す大、中、または小の区分を制御装置に入力するが、この区分は、バケットの種類によって異なる。そのため、バケットの付け替えを行う際に、オペレータは、バケットの重量を把握し、当該バケットに対応する区分を特定したうえで、入力を行う必要がある。また、法面バケットや、狭幅バケットなど形状が異なるバケットも存在するため、熟練のオペレータであっても、様々存在するバケットの重量の区分を特定することは困難である。<br/>
  また、誤った区分が設定される可能性があり、この場合には作業機の介入制御においてハンチングが生じる可能性がある。<br/>
  本発明の目的は、バケットの交換に伴う作業機の設定を容易に実施することができる制御装置および制御方法を提供することにある。
</p>
</tech-problem>
<tech-solution>
<p num="0005">
  本発明の態様によれば、制御装置は、アタッチメントを有する作業機を制御する制御装置であって、前記アタッチメントを識別するための種類情報の入力を受け付ける種類情報入力部と、前記種類情報と、前記アタッチメントの重量または重量の区分との対応を予め記憶する記憶部と、前記種類情報入力部に入力される前記種類情報に基づいて、対応する重量または重量の区分を特定する特定部とを備える。
</p>
</tech-solution>
<advantageous-effects>
<p num="0006">
  上記態様に係る制御装置によれば、オペレータは、アタッチメントの交換に伴う作業機の設定を容易に実施することができる。
</p>
</advantageous-effects>
</summary-of-invention>
<description-of-drawings>
<p num="0007">
<figref num="1">作業機の姿勢の例を示す図である。</figref>
<figref num="2">第１の実施形態に係る作業機械の構成を示す概略図である。</figref>
<figref num="3">第１の実施形態に係る作業機制御装置および入出力装置の構成を示すブロック図である。</figref>
<figref num="4">第１の実施形態に係る制御装置による制御に用いられる情報の一例である。</figref>
<figref num="5">第１の実施形態に係る作業機械のバケットの第１の設定方法を示すフローチャートである。</figref>
<figref num="6">第１の実施形態に係る作業機械のバケットの第２の設定方法を示すフローチャートである。</figref>
<figref num="7">バケット情報入力画面の一例である。</figref>
<figref num="8">第１の実施形態に係る作業機制御装置の動作を示すフローチャートである。</figref>
<figref num="9">第１の実施形態に係る入出力装置による表示動作を示すフローチャートである。</figref>
</p>
</description-of-drawings>
<description-of-embodiments>
<p num="0008">
  以下、図面を参照しながら実施形態について詳しく説明する。<br/>
〈座標系〉<br/>
  図１は、作業機の姿勢の例を示す図である。<br/>
  以下の説明においては、三次元の現場座標系（Ｘｇ、Ｙｇ、Ｚｇ）および三次元の車体座標系（Ｘｍ、Ｙｍ、Ｚｍ）を規定して、これらに基づいて位置関係を説明する。
</p>
<p num="0009">
  現場座標系は、施工現場に設けられたＧＮＳＳ基準局の位置を基準点として南北に伸びるＸｇ軸、東西に伸びるＹｇ軸、鉛直方向に伸びるＺｇ軸から構成される座標系である。ＧＮＳＳの例としては、ＧＰＳ（Global Positioning System）が挙げられる。
</p>
<p num="0010">
  車体座標系は、後述する作業機械１００の旋回体１２０に規定された代表点Ｏを基準として前後に伸びるＸｍ軸、左右に伸びるＹｍ軸、上下に伸びるＺｍ軸から構成される座標系である。旋回体１２０の代表点Ｏを基準として前方を＋Ｘｍ方向、後方を−Ｘｍ方向、左方を＋Ｙｍ方向、右方を−Ｙｍ方向、上方向を＋Ｚｍ方向、下方向を−Ｚｍ方向とよぶ。
</p>
<p num="0011">
  後述する作業機械１００の作業機制御装置１５０は、演算により、ある座標系における位置を、他の座標系における位置に変換することができる。例えば、作業機制御装置１５０は、車体座標系における位置を現場座標系における位置に変換することができ、その逆の座標系にも変換することができる。
</p>
<p num="0012">
〈第１の実施形態〉<br/>
《作業機械》<br/>
  図２は、第１の実施形態に係る作業機械の構成を示す概略図である。<br/>
  作業機械１００は、走行体１１０と、走行体１１０に支持される旋回体１２０と、油圧により作動し旋回体１２０に支持される作業機１３０とを備える。旋回体１２０は、旋回中心を中心として走行体１１０に旋回自在に支持される。
</p>
<p num="0013">
  走行体１１０は、左右に設けられた２つの無限軌道１１１と、各無限軌道１１１を駆動するための２つの走行モータ１１２を備える。
</p>
<p num="0014">
  作業機１３０は、ブーム１３１と、アーム１３２と、バケット１３３と、ブームシリンダ１３４と、アームシリンダ１３５と、バケットシリンダ１３６とを備える。
</p>
<p num="0015">
  ブーム１３１の基端部は、旋回体１２０にブームピンＰ１を介して取り付けられる。<br/>
  アーム１３２は、ブーム１３１とバケット１３３とを連結する。アーム１３２の基端部は、ブーム１３１の先端部にアームピンＰ２を介して取り付けられる。<br/>
  バケット１３３は、土砂などを掘削するための刃先と掘削した土砂を収容するための収容部とを備える。バケット１３３の基端部は、アーム１３２の先端部にバケットピンＰ３を介して取り付けられる。なお、バケット１３３は、例えば法面バケットのように整地を目的としたバケットでもよいし、収容部を備えないバケットでもよい。また、他の実施形態においては、作業機１３０は、バケット１３３に代えて、打突によって岩石を粉砕するブレーカなどの他のアタッチメントを備えてもよい。
</p>
<p num="0016">
  ブームシリンダ１３４は、ブーム１３１を作動させるための油圧シリンダである。ブームシリンダ１３４の基端部は、旋回体１２０に取り付けられる。ブームシリンダ１３４の先端部は、ブーム１３１に取り付けられる。<br/>
  アームシリンダ１３５は、アーム１３２を駆動するための油圧シリンダである。アームシリンダ１３５の基端部は、ブーム１３１に取り付けられる。アームシリンダ１３５の先端部は、アーム１３２に取り付けられる。<br/>
  バケットシリンダ１３６は、バケット１３３を駆動するための油圧シリンダである。バケットシリンダ１３６の基端部は、アーム１３２に取り付けられる。バケットシリンダ１３６の先端部は、バケット１３３に取り付けられる。
</p>
<p num="0017">
  旋回体１２０には、オペレータが搭乗する運転室１２１が備えられる。運転室１２１は、旋回体１２０の前方かつ作業機１３０の左側に備えられる。<br/>
  旋回体１２０は、エンジン１２２、油圧ポンプ１２３、コントロールバルブ１２４、旋回モータ１２５、操作装置１２６、作業機制御装置１５０、入出力装置１６０を備える。
</p>
<p num="0018">
  エンジン１２２は、油圧ポンプ１２３を駆動する原動機である。<br/>
  油圧ポンプ１２３は、エンジン１２２により駆動され、コントロールバルブ１２４を介して各アクチュエータ（ブームシリンダ１３４、アームシリンダ１３５、バケットシリンダ１３６、走行モータ１１２、および旋回モータ１２５）に作動油を供給する。<br/>
  コントロールバルブ１２４は、油圧ポンプ１２３から作業機１３０を作動させるための各アクチュエータへ供給される作動油の流量を制御する。<br/>
  旋回モータ１２５は、コントロールバルブ１２４を介して油圧ポンプ１２３から供給される作動油によって駆動し、旋回体１２０を旋回させる。
</p>
<p num="0019">
  操作装置１２６は、運転室１２１の内部に設けられる２つのレバーである。操作装置１２６は、オペレータから、ブーム１３１の上げ操作および下げ操作、アーム１３２の押し操作および引き操作、バケット１３３の掘削操作およびダンプ操作、ならびに旋回体１２０の右旋回操作および左旋回操作を受け付ける。操作装置１２６の傾きに応じて、コントロールバルブ１２４の各アクチュエータへつながる流路の開度が制御される。例えば、操作装置１２６は、傾きに応じてパイロット作動油の流量を変化させるバルブを有し、パイロット作動油の流量に応じてコントロールバルブ１２４のスプールを変位させることで、コントロールバルブ１２４の開度を制御する。また例えば、操作装置１２６は、その傾きを検出する傾斜センサを備え、傾斜センサの出力信号の大きさに応じてコントロールバルブ１２４のスプールを変位させることで、コントロールバルブ１２４の開度を制御してもよい。なお、走行体１１０は、図示されていないレバーによって前進操作および後退操作を受け付ける。
</p>
<p num="0020">
  作業機制御装置１５０は、作業機械１００に設けられた後述する複数の計測装置の計測値に基づいて、現場座標系におけるバケット１３３の位置および姿勢を特定する。また、作業機制御装置１５０は、コントロールバルブ１２４にブームシリンダ１３４の制御指令、アームシリンダ１３５の制御指令、およびバケットシリンダ１３６の制御指令を出力する。
</p>
<p num="0021">
  入出力装置１６０は、作業機械１００のバケット１３３と施工現場の設計面との関係を示す画面を表示する。また入出力装置１６０は、利用者の操作に従って入力信号を生成し、作業機制御装置１５０に出力する。入出力装置１６０は、作業機械１００の運転室に設けられる。
</p>
<p num="0022">
  作業機械１００は、複数の計測装置を備える。各計測装置は、計測値を作業機制御装置１５０に出力する。具体的には、作業機械１００は、ブームストロークセンサ１４１、アームストロークセンサ１４２、バケットストロークセンサ１４３、位置方位演算器１４４、傾斜検出器１４５を備える。
</p>
<p num="0023">
  ブームストロークセンサ１４１は、ブームシリンダ１３４のストローク量を計測する。<br/>
  アームストロークセンサ１４２は、アームシリンダ１３５のストローク量を計測する。<br/>
  バケットストロークセンサ１４３は、バケットシリンダ１３６のストローク量を計測する。<br/>
  これにより、作業機制御装置１５０は、ブームシリンダ１３４、アームシリンダ１３５、およびバケットシリンダ１３６のそれぞれのストローク長に基づいて、バケット１３３を含む作業機１３０の車体座標系における位置および姿勢角を検出することができる。なお、他の実施形態においては、ブームシリンダ１３４、アームシリンダ１３５、およびバケットシリンダ１３６に代えて、作業機１３０に取り付けられた傾斜計、ＩＭＵ等の角度センサや他のセンサによって作業機１３０の車体座標系における位置および姿勢角が検出されてもよい。
</p>
<p num="0024">
  位置方位演算器１４４は、旋回体１２０の現場座標系における位置および旋回体１２０が向く方位を演算する。位置方位演算器１４４は、ＧＮＳＳを構成する人工衛星から測位信号を受信する第１受信器１４４１および第２受信器１４４２を備える。第１受信器１４４１および第２受信器１４４２は、それぞれ旋回体１２０の異なる位置に設置される。位置方位演算器１４４は、第１受信器１４４１が受信した測位信号に基づいて、現場座標系における旋回体１２０の代表点Ｏ（車体座標系の原点）の位置を検出する。<br/>
  位置方位演算器１４４は、第１受信器１４４１が受信した測位信号と、第２受信器１４４２が受信した測位信号とを用いて、旋回体１２０の現場座標系における方位を演算する。
</p>
<p num="0025">
  傾斜検出器１４５は、旋回体１２０の加速度および角速度を計測し、計測結果に基づいて旋回体１２０の姿勢（例えば、Ｘｍ軸に対する回転を表すロール、Ｙｍ軸に対する回転を表すピッチ、およびＺｍ軸に対する回転を表すヨー）を検出する。傾斜検出器１４５は、例えば運転室１２１の下面に設置される。傾斜検出器１４５の例としては、ＩＭＵ（Inertial Measurement Unit：慣性計測装置）が挙げられる。
</p>
<p num="0026">
《作業機の姿勢》<br/>
  ここで、図１を参照しながら作業機１３０の位置及び姿勢について説明する。作業機制御装置１５０は、作業機１３０の位置及び姿勢を算出し、その位置及び姿勢に基づいて作業機１３０の制御指令を生成する。作業機制御装置１５０は、ブームピンＰ１を基準としたブーム１３１の姿勢角であるブーム相対角α、アームピンＰ２を基準としたアーム１３２の姿勢角であるアーム相対角β、バケットピンＰ３を基準としたバケット１３３の姿勢角であるバケット相対角γ、および車体座標系におけるバケット１３３の刃先の位置を算出する。
</p>
<p num="0027">
  ブーム相対角αは、ブームピンＰ１から旋回体１２０の上方向（＋Ｚｍ方向）に伸びる半直線と、ブームピンＰ１からアームピンＰ２へ伸びる半直線とがなす角によって表される。なお、旋回体１２０の姿勢（ピッチ角）θによって、旋回体１２０の上方向（＋Ｚｍ方向）と鉛直上方向（＋Ｚｇ方向）は必ずしも一致しない。<br/>
  アーム相対角βは、ブームピンＰ１からアームピンＰ２へ伸びる半直線と、アームピンＰ２からバケットピンＰ３へ伸びる半直線とがなす角によって表される。<br/>
  バケット相対角γは、アームピンＰ２からバケットピンＰ３へ伸びる半直線と、バケットピンＰ３からバケット１３３の刃先へ伸びる半直線とがなす角によって表される。<br/>
  ここで、車体座標系のＺｍ軸に対するバケット１３３の姿勢角であるバケット絶対角ηは、ブーム相対角α、アーム相対角β、バケット相対角γの和と等しい。バケット絶対角ηは、バケットピンＰ３から旋回体１２０の上方向（＋Ｚｍ方向）に伸びる半直線と、バケットピンＰ３からバケット１３３の刃先へ伸びる半直線とがなす角に等しい。
</p>
<p num="0028">
  バケット１３３の刃先の位置は、ブーム１３１の寸法であるブーム長Ｌ１、アーム１３２の寸法であるアーム長Ｌ２、バケット１３３の寸法であるバケット長Ｌ３、ブーム相対角α、アーム相対角β、バケット相対角γ、バケット１３３の形状情報、旋回体１２０の代表点Ｏの現場座標系における位置、および代表点ＯとブームピンＰ１との位置関係から求められる。ブーム長Ｌ１は、ブームピンＰ１からアームピンＰ２までの距離である。アーム長Ｌ２は、アームピンＰ２からバケットピンＰ３までの距離である。バケット長Ｌ３は、バケットピンＰ３からバケット１３３の刃先までの距離である。代表点ＯとブームピンＰ１との位置関係は、例えば、車体座標系におけるブームピンＰ１の位置によって表される。
</p>
<p num="0029">
《介入制御》<br/>
  作業機制御装置１５０は、施工現場において設定された設計面にバケット１３３が侵入しないようにバケット１３３が施工対象に接近する方向の速度を制限する。以下、作業機制御装置１５０がバケット１３３の速度を制限することを介入制御ともいう。
</p>
<p num="0030">
  介入制御において作業機制御装置１５０は、バケット１３３と設計面との距離が所定距離未満になった場合に、設計面にバケット１３３が侵入しないように、ブームシリンダ１３４の制御指令を生成してコントロールバルブ１２４に当該制御指令を出力する。これにより、バケット１３３の速度がバケット１３３と設計面との距離に応じた速度となるように、ブーム１３１が駆動する。つまり作業機制御装置１５０は、ブームシリンダ１３４の制御指令によってブーム１３１を上昇させることでバケット１３３の速度を制限する。<br/>
  なお、他の実施形態においては、介入制御においてアームシリンダ１３５の制御指令またはバケットシリンダ１３６の制御指令を出力しても良い。つまり、他の実施形態においては、介入制御においてアーム１３２を上昇させることでバケット１３３の速度を制限してもよいし、バケット１３３の速度を直接制限してもよい。
</p>
<p num="0031">
《作業機制御装置》<br/>
  図３は、第１の実施形態に係る作業機制御装置および入出力装置の構成を示すブロック図である。作業機制御装置１５０および入出力装置１６０は、作業機械１００の制御装置の一例である。<br/>
  作業機制御装置１５０は、プロセッサ１５１、メインメモリ１５３、ストレージ１５５、インタフェース１５７を備える。
</p>
<p num="0032">
  ストレージ１５５には、作業機１３０を制御するためのプログラムが記憶されている。ストレージ１５５の例としては、ＨＤＤ（Hard Disk Drive）、ＳＳＤ（Solid State Drive）、不揮発性メモリ等が挙げられる。ストレージ１５５は、作業機制御装置１５０のバスに直接接続された内部メディアであってもよいし、インタフェース１５７または通信回線を介して作業機制御装置１５０に接続される外部メディアであってもよい。
</p>
<p num="0033">
  プロセッサ１５１は、ストレージ１５５からプログラムを読み出してメインメモリ１５３に展開し、プログラムに従って処理を実行する。またプロセッサ１５１は、プログラムに従ってメインメモリ１５３に記憶領域を確保する。インタフェース１５７は、コントロールバルブ１２４、操作装置１２６、入出力装置１６０、ブームストロークセンサ１４１、アームストロークセンサ１４２、バケットストロークセンサ１４３、位置方位演算器１４４、傾斜検出器１４５、およびその他の周辺機器と接続され、信号の入出力を行う。
</p>
<p num="0034">
  プログラムは、作業機制御装置１５０に発揮させる機能の一部を実現するためのものであってもよい。例えば、プログラムは、ストレージ１５５に既に記憶されている他のプログラムとの組み合わせ、または他の装置に実装された他のプログラムとの組み合わせによって機能を発揮させるものであってもよい。なお、他の実施形態においては、作業機制御装置１５０は、上記構成に加えて、または上記構成に代えてＰＬＤ（Programmable Logic Device）などのカスタムＬＳＩ（Large Scale Integrated Circuit）を備えてもよい。ＰＬＤの例としては、ＰＡＬ(Programmable Array Logic)、ＧＡＬ(Generic Array Logic)、ＣＰＬＤ(Complex Programmable Logic Device)、ＦＰＧＡ（Field Programmable Gate Array）が挙げられる。この場合、プロセッサによって実現される機能の一部または全部が当該集積回路によって実現されてよい。
</p>
<p num="0035">
  プロセッサ１５１は、プログラムの実行により、操作量取得部１５１１、検出情報取得部１５１２、バケット位置特定部１５１３、バケット位置通知部１５１４、距離特定部１５１５、制御線決定部１５１６、目標速度演算部１５１７、重量区分取得部１５１８、パラメータ特定部１５１９、制御指令生成部１５２０、制御指令出力部１５２１として機能する。<br/>
  また、ストレージ１５５には、作業機械情報記憶部１５５１、目標施工データ記憶部１５５２、パラメータ記憶部１５５３の記憶領域を確保されている。
</p>
<p num="0036">
  作業機械情報記憶部１５５１は、ブーム長Ｌ１、アーム長Ｌ２、バケット長Ｌ３、および旋回体１２０の代表点Ｏの位置とブームピンＰ１との位置関係を記憶する。
</p>
<p num="0037">
  目標施工データ記憶部１５５２は、施工現場の設計面を表す目標施工データを記憶する。目標施工データは、現場座標系で表される三次元データであって、設計面を表す複数の三角形ポリゴンからなる立体地形データ等である。目標施工データを構成する三角形ポリゴンは、それぞれ隣接する他の三角形ポリゴンと共通の辺を有する。つまり、目標施工データは、複数の平面から構成される連続した平面を表す。目標施工データは、外部記憶媒体から読み込まれることで、またはネットワークＮを介して外部サーバから受信されることで、目標施工データ記憶部１５５２に記憶される。
</p>
<p num="0038">
  図４は、第１の実施形態に係る制御装置による制御に用いられる情報の一例である。<br/>
  図４に示すように、パラメータ記憶部１５５３は、バケット１３３の重量の区分ごとに、コントロールバルブ１２４の開度とブームシリンダ１３４の速度との関係を示す相関データを記憶する。なお、重量の区分の数は、一例であって３つの区分に限られない。また、パラメータ記憶部１５５３は、重量ごとに相関データを記憶してもよい。バケット１３３の重量の区分は、バケット１３３の重量と作業機械１００の仕様との関係によって定まる大、中、または小の区分である。相関データは、コントロールバルブ１２４の開度に関するパラメータの一例である。なお、他の実施形態においては、パラメータ特定部１５１９は、相関データに代えて、基準の開度に掛ける係数や、コントロールバルブ１２４の開度を決定するプログラムを記憶してもよい。なお、バケット１３３の重量の区分、相関データ、基準の開度に掛ける係数、およびコントロールバルブ１２４の開度を決定するプログラムは、制御に関するパラメータの一例である。パラメータ記憶部１５５３は、記憶部の一例である。
</p>
<p num="0039">
  操作量取得部１５１１は、操作装置１２６から操作量を示す操作信号を取得する。操作量取得部１５１１は、少なくともブーム１３１に係る操作量、アーム１３２に係る操作量、およびバケット１３３に係る操作量を取得する。
</p>
<p num="0040">
  検出情報取得部１５１２は、ブームストロークセンサ１４１、アームストロークセンサ１４２、バケットストロークセンサ１４３、位置方位演算器１４４、および傾斜検出器１４５のそれぞれが検出した情報を取得する。つまり、検出情報取得部１５１２は、旋回体１２０の現場座標系における位置情報、旋回体１２０が向く方位、旋回体１２０の姿勢、ブームシリンダ１３４のストローク長、アームシリンダ１３５のストローク長、およびバケットシリンダ１３６のストローク長を取得する。
</p>
<p num="0041">
  バケット位置特定部１５１３は、検出情報取得部１５１２が取得した情報に基づいて、バケット１３３の位置および姿勢を特定する。このときバケット位置特定部１５１３は、バケット絶対角ηを特定する。バケット位置特定部１５１３は、以下の手順でバケット絶対角ηを特定する。バケット位置特定部１５１３は、ブームシリンダ１３４のストローク長から、ブーム相対角αを算出する。バケット位置特定部１５１３は、アームシリンダ１３５のストローク長から、アーム相対角βを算出する。バケット位置特定部１５１３は、バケットシリンダ１３６のストローク長から、バケット相対角γを算出する。そして、バケット位置特定部１５１３は、ブーム相対角α、アーム相対角β、およびバケット相対角γを加算することで、バケット絶対角ηを算出する。
</p>
<p num="0042">
  また、バケット位置特定部１５１３は、検出情報取得部１５１２が取得した情報と作業機械情報記憶部１５５１が記憶する情報とに基づいて、バケット１３３の刃先の現場座標系における位置を特定する。バケット位置特定部１５１３は、以下の手順で作業機１３０の刃先の現場座標系における位置を特定する。バケット位置特定部１５１３は、検出情報取得部１５１２が取得したブーム相対角αと作業機械情報記憶部１５５１が記憶するブーム長Ｌ１とに基づいて、車体座標系におけるアームピンＰ２の位置を特定する。バケット位置特定部１５１３は、アームピンＰ２の位置と、検出情報取得部１５１２が取得したアーム相対角βと作業機械情報記憶部１５５１が記憶するアーム長Ｌ２とに基づいて、車体座標系におけるバケットピンＰ３の位置を特定する。バケット位置特定部１５１３は、バケットピンＰ３の位置と、検出情報取得部１５１２が取得したバケット相対角γと、作業機械情報記憶部１５５１が記憶するバケット長Ｌ３とに基づいて、バケット１３３の刃先の位置および姿勢を特定する。そして、バケット位置特定部１５１３は、検出情報取得部１５１２が取得した旋回体１２０の現場座標系における位置情報、旋回体１２０が向く方位、および旋回体１２０の姿勢に基づいて、車体座標系におけるバケット１３３の刃先の位置を、現場座標系における位置に変換する。
</p>
<p num="0043">
  距離特定部１５１５は、バケット１３３の刃先と設計面との距離を特定する。例えば、距離特定部１５１５は、以下の方法で刃先と設計面との距離を特定する。<br/>
  距離特定部１５１５は、バケット１３３を縦断する複数の縦断面と設計面との交線をそれぞれ特定する。バケット１３３の複数の縦断面は、バケット１３３の両側面と、両側面に平行な面であって両側面の間を分割する面とからなる。距離特定部１５１５は、各縦断面について、当該縦断面上におけるバケット１３３の刃先と特定した交線との距離をそれぞれ求める。
</p>
<p num="0044">
  制御線決定部１５１６は、バケット１３３の介入制御に用いられる制御線を決定する。制御線決定部１５１６は、例えば、距離特定部１５１５が特定した最も短い距離に係る刃先を含むバケット１３３の縦断面と設計面との交線を制御線に決定する。なお、他の実施形態において制御線を決定するための縦断面は、最も短い距離に係る刃先を含むものに限られず、バケット１３３の中央を通る縦断面など予め定められた面や手動で選択された面であってもよい。
</p>
<p num="0045">
  バケット位置通知部１５１４は、バケット位置特定部１５１３が特定したバケット１３３の現場座標系における位置を、入出力装置１６０に通知する。
</p>
<p num="0046">
  目標速度演算部１５１７は、操作量取得部１５１１が取得した操作装置１２６の操作量に基づいて、ブームピンＰ１を基準としたブーム１３１の速度（ブーム相対速度）の目標値である目標ブーム相対速度、アームピンＰ２を基準としたアーム１３２の速度（アーム相対速度）の目標値である目標アーム相対速度、およびバケットピンＰ３を基準としたバケット１３３の速度（バケット相対速度）の目標値である目標バケット相対速度を決定する。<br/>
  なお、以下、ブーム相対速度、アーム相対速度およびバケット相対速度の垂直方向成分の和によって表される、旋回体１２０を基準としたバケット１３３の垂直方向の速度をバケット絶対速度といい、バケット絶対速度の目標値を目標バケット絶対速度という。目標バケット絶対速度は、目標ブーム相対速度、目標アーム相対速度および目標バケット相対速度の垂直方向成分の和によって表される。<br/>
  以下、垂直方向下向きの速度を正数で表し、垂直方向上向きの速度を負数で表す。
</p>
<p num="0047">
  重量区分取得部１５１８は、入出力装置１６０から、バケット１３３の大、中、または小の区分を取得する。
</p>
<p num="0048">
  パラメータ特定部１５１９は、パラメータ記憶部１５５３から重量区分取得部１５１８が取得した区分に関連付けられた相関データを特定する。
</p>
<p num="0049">
  制御指令生成部１５２０は、距離特定部１５１５が特定した距離に基づいて、バケット１３３が制御線より下方に侵入しないように作業機１３０を制御する介入制御を行う。制御指令生成部１５２０は、バケット１３３の刃先と制御線との距離とバケット１３３が制御線に接近するバケット絶対速度の許容上限値との関係を示す速度テーブルを満たすよう、ブーム１３１の垂直方向の制限速度を決定する。速度テーブルの例としては、バケット１３３の刃先と制御線との距離が０に近づくほどバケット絶対速度の許容上限値が０に近づくテーブルが挙げられる。なお、本実施形態においては、制御指令生成部１５２０が、ブーム１３１の垂直方向の制限速度を決定するが、これに限られず、例えば法線方向の制限速度を決定してもよい。<br/>
  例えば、制御指令生成部１５２０は、速度テーブルにおけるバケット絶対速度の許容上限値より目標バケット絶対速度が大きい場合、介入制御を行う。制御指令生成部１５２０は、介入制御を行う場合、バケット絶対速度の上限値から目標アーム相対速度および目標バケット相対速度の垂直方向成分の和を減算することで、ブーム１３１の垂直方向の制限速度を算出する。制御指令生成部１５２０は、ブーム１３１の垂直方向の制限速度から、ブーム相対速度を決定する。<br/>
  他方、制御指令生成部１５２０は、目標バケット絶対速度が、速度テーブルにおけるバケット絶対速度の許容上限値以下である場合、介入制御を行わない。介入制御を行わない場合、制御指令生成部１５２０は、目標ブーム相対速度、目標アーム相対速度および目標バケット相対速度に基づいて、ブーム１３１、アーム１３２およびバケット１３３の制御指令を生成する。<br/>
  このとき、制御指令生成部１５２０は、パラメータ特定部１５１９が特定した相関データと目標ブーム相対速度とに基づいて、ブームシリンダ１３４に作動油を流すコントロールバルブ１２４の開度を制御する制御指令を生成する。制御指令生成部１５２０は、コントロールバルブ１２４の制御量を決定する制御部の一例である。
</p>
<p num="0050">
  制御指令出力部１５２１は、制御指令生成部１５２０が生成したブーム１３１の制御指令、アーム１３２の制御指令、およびバケット１３３の制御指令をコントロールバルブ１２４に出力する。
</p>
<p num="0051">
《入出力装置》<br/>
  入出力装置１６０は、プロセッサ１６１、メインメモリ１６３、ストレージ１６５、インタフェース１６７、タッチパネル１６９を備える。
</p>
<p num="0052">
  ストレージ１６５には、作業機１３０と設計面との関係を表示するためのプログラムが記憶されている。ストレージ１６５の例としては、ＨＤＤ、ＳＳＤ、不揮発性メモリ等が挙げられる。ストレージ１６５は、入出力装置１６０のバスに直接接続された内部メディアであってもよいし、インタフェース１６７または通信回線を介して入出力装置１６０に接続される外部メディアであってもよい。
</p>
<p num="0053">
  プロセッサ１６１は、ストレージ１６５からプログラムを読み出してメインメモリ１６３に展開し、プログラムに従って処理を実行する。またプロセッサ１６１は、プログラムに従ってメインメモリ１６３に記憶領域を確保する。インタフェース１６７は、作業機制御装置１５０およびタッチパネル１６９と、およびその他の周辺機器と接続され、信号の入出力を行う。
</p>
<p num="0054">
  プログラムは、入出力装置１６０に発揮させる機能の一部を実現するためのものであってもよい。例えば、プログラムは、ストレージ１６５に既に記憶されている他のプログラムとの組み合わせ、または他の装置に実装された他のプログラムとの組み合わせによって機能を発揮させるものであってもよい。<br/>
なお、他の実施形態においては、入出力装置１６０は、上記構成に加えて、または上記構成に代えてＰＬＤ（Programmable Logic Device）などのカスタムＬＳＩ（Large Scale Integrated Circuit）を備えてもよい。ＰＬＤの例としては、ＰＡＬ(Programmable Array Logic)、ＧＡＬ(Generic Array Logic)、ＣＰＬＤ(Complex Programmable Logic Device)、ＦＰＧＡ（Field Programmable Gate Array）が挙げられる。この場合、プロセッサによって実現される機能の一部または全部が当該集積回路によって実現されてよい。
</p>
<p num="0055">
  プロセッサ１６１は、プログラムの実行により、バケット情報入力部１６１１、バケット選択部１６１２、区分特定部１６１３、区分通知部１６１４、バケット位置取得部１６１５、バケット位置表示部１６１６として機能する。また、ストレージ１６５には、バケット情報記憶部１６５１、区分情報記憶部１６５２、仕様記憶部１６５３の記憶領域が確保されている。
</p>
<p num="0056">
  バケット情報記憶部１６５１は、バケット１３３の種類情報に関連付けて、当該バケットの寸法、および重量または重量の区分を記憶する。バケット１３３の種類情報の例としては、バケット１３３の型番、名称、およびＩＤなどが挙げられる。バケット情報記憶部１６５１は、記憶部の一例である。<br/>
  区分情報記憶部１６５２は、図４に示すように、バケット１３３の重量の区分と、その区分に属するバケット１３３の重量の範囲とのセットを作業機械１００の仕様毎に記憶する。作業機械１００の仕様の例としては、作業機械１００の型番、名称、およびＩＤなどが挙げられる。区分情報記憶部１６５２は、記憶部の一例である。<br/>
  仕様記憶部１６５３は、当該入出力装置１６０を搭載する作業機械１００の仕様を記憶する。仕様記憶部１６５３は、記憶部の一例である。
</p>
<p num="0057">
  バケット情報入力部１６１１は、利用者から、バケット１３３の種類情報、寸法、および重量、または重量の区分の入力を受け付ける。バケット情報入力部１６１１は、入力された情報をバケット情報記憶部に記憶させる。バケット情報入力部１６１１は、種類情報入力部および重量入力部の一例である。なお、他の実施形態に係るバケット情報入力部１６１１は、バケット１３３に埋め込まれたＲＦＩＤ（Radio Frequency Identifier）タグからバケット１３３の種類情報、寸法および重量を読み取ってもよい。
</p>
<p num="0058">
  バケット選択部１６１２は、タッチパネル１６９にバケット情報記憶部１６５１が記憶するバケット１３３の種類情報の一覧を表示させる。バケット選択部１６１２は、利用者から、作業機１３０に取り付けられているものの種類情報の選択を受け付ける。バケット選択部１６１２は、種類情報入力部の一例である。
</p>
<p num="0059">
  区分特定部１６１３は、区分情報記憶部１６５２が記憶する情報と、仕様記憶部１６５３が記憶する情報とに基づいて、バケット選択部１６１２によって選択されたバケット１３３の重量の区分を特定する。区分特定部１６１３は、特定部の一例である。
</p>
<p num="0060">
  区分通知部１６１４は、区分特定部１６１３が特定した重量の区分、またはバケット情報記憶部１６５１が記憶する重量の区分もしくは重量を作業機制御装置１５０に通知する。区分通知部１６１４は、送信部の一例である。
</p>
<p num="0061">
  バケット位置取得部１６１５は、作業機制御装置１５０から、バケット絶対角η、バケット１３３の現場座標系における位置、および制御線を取得する。
</p>
<p num="0062">
  バケット位置表示部１６１６は、バケット位置取得部１６１５が取得したバケット１３３の情報と、バケット情報記憶部１６５１が記憶するバケット１３３の寸法とに基づいて、バケット１３３と施工現場の設計面との関係を示す画面を表示する。
</p>
<p num="0063">
《バケット設定方法》<br/>
  以下、第１の実施形態に係る作業機械１００の制御方法について説明する。<br/>
  まず作業機械１００のオペレータは、入出力装置１６０により、作業機械１００が備えるバケット１３３の情報を設定する。ここでは、入出力装置１６０によるバケット１３３の情報の設定方法として２種類の方法について説明する。
</p>
<p num="0064">
《第１の設定方法》<br/>
  図５は、第１の実施形態に係る作業機械のバケットの第１の設定方法を示すフローチャートである。なお、第１の設定方法に係る重量の区分は、バケット１３３の重量のみによって一意に決まる区分である。<br/>
  入出力装置１６０のバケット選択部１６１２は、バケット情報記憶部１６５１が記憶するバケット１３３の種類情報を読み出す（ステップＳ０１）。バケット選択部１６１２は、読み出したバケット１３３の種類情報と、新規のバケット１３３の登録ボタンとを含む選択画面を表示するための表示信号を、タッチパネル１６９に出力する（ステップＳ０２）。これにより、タッチパネルには、バケット１３３の選択画面が表示される。<br/>
  利用者は、タッチパネル１６９に表示される選択画面の中から作業機械１００に取り付けられたバケット１３３を探す。選択画面の中に取り付けられたバケット１３３がある場合、利用者は、選択画面のうち当該バケット１３３を表す種類情報を選択する。他方、選択画面の中に取り付けられたバケット１３３がない場合、利用者は、登録ボタンを押下する。
</p>
<p num="0065">
  バケット選択部１６１２は、選択画面に含まれる種類情報が選択されたか、登録ボタンが押下されたかを判定する（ステップＳ０３）。選択画面に含まれる種類情報が選択された場合（ステップＳ０３：種類情報）、バケット選択部１６１２は、選択された種類情報に関連付けられたバケット１３３の寸法、および重量または重量の区分を特定する（ステップＳ０４）。<br/>
  他方、ステップＳ０３において登録ボタンが押下された場合（ステップＳ０３：ボタン）、バケット情報入力部１６１１は、図７に示すようなバケット情報入力画面を表示させる（ステップＳ０５）。図７は、バケット情報入力画面の一例である。バケット情報入力画面には、バケット１３３の種類情報、寸法、および重量または重量の区分の入力欄が表示される。バケット１３３の寸法は、バケットピンＰ３から刃先までの長さ、バケットピンＰ３からバケット１３３の複数の輪郭点までの長さおよび角度、バケット１３３の幅、バケット１３３の刃の長さを含む。
</p>
<p num="0066">
  バケット情報入力部１６１１は、利用者からバケット１３３の種類情報、寸法、および重量または重量の区分の入力を受け付ける（ステップＳ０６）。バケット情報入力部１６１１は、入力された種類情報、寸法、および重量または重量の区分を関連付けてバケット情報記憶部１６５１に記憶させる。これにより、次回以降、バケット選択部１６１２が生成する選択画面に、当該バケット１３３の種類情報が含まれる。<br/>
  ステップＳ０４またはステップＳ０６で重量または重量の区分が特定されると、区分通知部１６１４は、特定された重量または重量の区分を作業機制御装置１５０に通知する（ステップＳ０７）。これにより、作業機制御装置１５０の重量区分取得部１５１８は、入出力装置１６０から重量の区分を取得し、メインメモリ１５３に記憶させる。なお、重量区分取得部１５１８は、種類情報に関連付けられたバケット１３３の重量を特定し、特定された重量を作業機制御装置１５０に通知してもよい。この場合、作業機制御装置１５０が、重量に対応する重量の区分を特定する。
</p>
<p num="0067">
《第２の設定方法》<br/>
  重量の区分は、重量によって一意に決まるものではなく、作業機械１００の仕様に対する相対的な重量を表す場合がある。具体的には、この区分は、作業機械１００が備える作業機１３０全体の重量におけるバケット１３３の重量の割合や、作業機械１００の油圧ポンプの容量とバケット１３３の重量等との関係等によって定まる場合がある。その場合であっても、以下の第２の設定方法によって、区分を特定することができる。
</p>
<p num="0068">
  図６は、第１の実施形態に係る作業機械のバケットの第２の設定方法を示すフローチャートである。<br/>
  入出力装置１６０のバケット選択部１６１２は、バケット情報記憶部１６５１が記憶するバケット１３３の種類情報を読み出す（ステップＳ１１）。バケット選択部１６１２は、読み出したバケット１３３の種類情報と、新規のバケット１３３の登録ボタンとを含む選択画面を表示するための表示信号を、タッチパネル１６９に出力する（ステップＳ１２）。これにより、タッチパネルには、バケット１３３の選択画面が表示される。
</p>
<p num="0069">
  利用者は、タッチパネル１６９に表示される選択画面の中から作業機械１００に取り付けられたバケット１３３を探す。選択画面の中に取り付けられたバケット１３３がある場合、利用者は、選択画面のうち当該バケット１３３を表す種類情報を選択する。他方、選択画面の中に取り付けられたバケット１３３がない場合、利用者は、登録ボタンを押下する。
</p>
<p num="0070">
  バケット選択部１６１２は、選択画面に含まれる種類情報が選択されたか、登録ボタンが押下されたかを判定する（ステップＳ１３）。選択画面に含まれる種類情報が選択された場合（ステップＳ１３：種類情報）、バケット選択部１６１２は、選択された種類情報に関連付けられたバケット１３３の寸法および重量を特定する（ステップＳ１４）。区分特定部１６１３は、区分情報記憶部１６５２が作業機械１００の仕様毎に記憶するバケット１３３の重量の区分と、その区分に属するバケット１３３の重量の範囲とのセットの中から、仕様記憶部１６５３が記憶する作業機械１００の仕様に対応するセットを特定する。そして、バケット選択部１６１２によって特定された重量を含む重量の範囲に関連付けられた区分を特定する（ステップＳ１５）。
</p>
<p num="0071">
  他方、ステップＳ１３において登録ボタンが押下された場合（ステップＳ１３：ボタン）、バケット情報入力部１６１１は、図７に示すようなバケット情報入力画面を表示させる（ステップＳ１６）。図７は、バケット情報入力画面の一例である。バケット情報入力画面には、バケット１３３の種類情報、寸法および重量の入力欄が表示される。バケット１３３の寸法は、バケットピンＰ３から刃先までの長さ、バケットピンＰ３からバケット１３３の複数の輪郭点までの長さおよび角度、バケット１３３の幅、バケット１３３の刃の長さを含む。<br/>
  バケット情報入力部１６１１は、利用者からバケット１３３の種類情報、寸法および重量の入力を受け付ける（ステップＳ１７）。バケット情報入力部１６１１は、入力された種類情報、寸法および重量を関連付けてバケット情報記憶部１６５１に記憶させる。これにより、次回以降、バケット選択部１６１２が生成する選択画面に、当該バケット１３３の種類情報が含まれる。<br/>
  区分特定部１６１３は、ステップＳ１５と同様の手法により、区分情報記憶部１６５２が、入力された重量が属する重量の範囲と、仕様記憶部１６５３が記憶する作業機械１００の仕様とに関連付けて記憶する重量の区分を特定する（ステップＳ０８）。
</p>
<p num="0072">
  ステップＳ５またはステップＳ８で重量の区分が特定されると、区分通知部１６１４は、特定された重量の区分を作業機制御装置１５０に通知する（ステップＳ０９）。これにより、作業機制御装置１５０の重量区分取得部１５１８は、入出力装置１６０から重量の区分を取得し、メインメモリ１５３に記憶させる。
</p>
<p num="0073">
《作業機制御方法》<br/>
  図８は、第１の実施形態において設定された重量の区分を用いた介入制御処理を示すフローチャートである。作業機械１００のオペレータが作業機械１００の操作を開始すると、作業機制御装置１５０は、所定の制御周期ごとに以下に示す制御を実行する。
</p>
<p num="0074">
  操作量取得部１５１１は、操作装置１２６からブーム１３１に係る操作量、アーム１３２に係る操作量、バケット１３３に係る操作量、および旋回に係る操作量を取得する（ステップＳ３１）。検出情報取得部１５１２は、位置方位演算器１４４、傾斜検出器１４５、ストローク検出器１３７のそれぞれが検出した情報を取得する（ステップＳ３２）。
</p>
<p num="0075">
  バケット位置特定部１５１３は、各油圧シリンダのストローク長からブーム相対角α、アーム相対角β、およびバケット相対角γを算出する（ステップＳ３３）。またバケット位置特定部１５１３は、算出した相対角α、β、γと、作業機械情報記憶部１５５１が記憶するブーム長Ｌ１、アーム長Ｌ２、バケット長Ｌ３およびバケット１３３の形状情報と、検出情報取得部１５１２が取得した旋回体１２０の位置、方位および姿勢とに基づいて、バケット絶対角ηおよび現場座標系におけるバケット１３３の刃先の位置を算出する（ステップＳ３４）。
</p>
<p num="0076">
  距離特定部１５１５は、バケット１３３の刃先と目標施工データ記憶部１５５２が記憶する目標施工データが表す設計面との距離を特定する（ステップＳ３５）。制御線決定部１５１６は、距離特定部１５１５が特定した距離に基づいて制御線を決定する（ステップＳ３６）。
</p>
<p num="0077">
  バケット位置通知部１５１４は、バケット位置特定部１５１３が特定したバケット絶対角ηおよび刃先の位置、ならびに制御線決定部１５１６が決定した制御線を、入出力装置１６０に通知する（ステップＳ３７）。
</p>
<p num="0078">
  目標速度演算部１５１７は、ステップＳ３１で操作量取得部１５１１が取得した操作量に基づいて、目標ブーム相対速度、目標アーム相対速度および目標バケット相対速度を算出する（ステップＳ３８）。
</p>
<p num="0079">
  制御指令生成部１５２０は、距離特定部１５１５が特定した距離が所定距離未満であるか否かを判定する（ステップＳ３９）。制御線とバケット１３３の刃先との距離が所定距離以上である場合（ステップＳ３９：ＮＯ）、制御指令生成部１５２０は、介入制御を行わない。介入制御を行わない場合、制御指令生成部１５２０は、目標ブーム相対速度、目標アーム相対速度および目標バケット相対速度に基づいて、ブーム１３１、アーム１３２およびバケット１３３の制御指令を生成する（ステップＳ４０）。
</p>
<p num="0080">
  他方、制御線とバケット１３３の刃先との距離が所定距離未満である場合（ステップＳ３９：ＹＥＳ）、制御指令生成部１５２０は、介入制御を行う。介入制御を行う場合、制御指令生成部１５２０は、距離特定部１５１５が特定した距離と作業機械情報記憶部１５５１に記憶されている上述の速度テーブルとに基づいてバケット絶対速度の許容上限値を特定する（ステップＳ４１）。次に、制御指令生成部１５２０は、ステップＳ３８で算出した目標ブーム相対速度、目標アーム相対速度、および目標バケット相対速度の垂直方向成分に基づいて、目標バケット絶対速度を算出する（ステップＳ４２）。次に、制御指令生成部１５２０は、ステップＳ１３で算出した目標バケット絶対速度が、ステップＳ４１で特定したバケット絶対速度の許容上限値未満であるか否かを判定する（ステップＳ４３）。
</p>
<p num="0081">
  目標バケット絶対速度がバケット絶対速度の許容上限値未満である場合（ステップＳ４３：ＹＥＳ）、制御指令生成部１５２０は、目標ブーム相対速度、目標アーム相対速度および目標バケット相対速度に基づいて、ブーム１３１、アーム１３２およびバケット１３３の制御指令を生成する（ステップＳ４０）。他方、目標バケット絶対速度がバケット絶対速度の許容上限値以上である場合（ステップＳ４３：ＮＯ）、パラメータ特定部１５１９は、パラメータ記憶部１５５３から、メインメモリ１５３が記憶する重量の区分に関連付けられた相関データを特定する（ステップＳ４４）。そして、制御指令生成部１５２０は、特定した相関データ、および目標バケット絶対速度とバケット絶対速度との差分に基づいてブーム１３１、アーム１３２およびバケット１３３の制御指令を生成する（ステップＳ４５）。
</p>
<p num="0082">
  制御指令生成部１５２０がブーム１３１、アーム１３２およびバケット１３３の制御指令を生成すると、制御指令出力部１５２１は、当該制御指令をコントロールバルブ１２４に出力する（ステップＳ４６）。これにより、コントロールバルブ１２４は、ブームシリンダ１３４、アームシリンダ１３５、およびバケットシリンダ１３６を駆動させる。
</p>
<p num="0083">
《バケットの表示方法》<br/>
  図９は、第１の実施形態において特定されまたは入力されたバケットの寸法を用いた入出力装置による表示動作を示すフローチャートである。作業機械１００のオペレータが作業機械１００の操作を開始すると、入出力装置１６０は、所定の制御周期ごとに以下に示す制御を実行する。
</p>
<p num="0084">
  入出力装置１６０のバケット位置取得部１６１５は、作業機制御装置１５０からバケット絶対角η、バケット１３３の刃先の現場座標系における位置、および制御線を取得する（ステップＳ６１）。バケット位置表示部１６１６は、バケット選択部１６１２に特定され、またはバケット情報入力部１６１１によって入力されたバケット１３３の寸法に基づいて、バケット１３３の画像を生成する（ステップＳ６２）。バケット位置表示部１６１６は、生成した画像を、バケット絶対角ηに基づいて回転させる（ステップＳ６３）。バケット位置表示部１６１６は、取得した刃先の位置および制御線を画像座標系に変換し、制御線を表す線分とバケット１３３の画像とを描画した画面データを生成する（ステップＳ６４）。バケット位置表示部１６１６は、生成した画面データをタッチパネル１６９に出力する（ステップＳ６５）。これにより、タッチパネル１６９には、バケット１３３と設計面の位置関係を表す画面が表示される。
</p>
<p num="0085">
《作用・効果》<br/>
  第１の実施形態の第１の設定方法によれば、制御装置（作業機制御装置１５０および入出力装置１６０）は、バケット１３３の種類情報の入力を受け付け、バケット情報記憶部１６５１によって、バケット１３３の重量の区分、またはバケット１３３の重量を特定することができる。そのため、オペレータは、バケット１３３を交換したときに、バケット１３３の重量の区分、またはバケット１３３の重量を特定する必要がない。これにより、オペレータは、バケット１３３の交換に伴う作業機１３０の設定を容易に実施することができる。<br/>
  第１の実施形態の第２の設定方法によれば、制御装置（作業機制御装置１５０および入出力装置１６０）は、バケット１３３の種類情報の入力を受け付け、区分特定部１６１３、区分情報記憶部１６５２、仕様記憶部１６５３によって、バケット１３３の重量を特定することができる。そのため、作業機械の仕様によって、重量の区分が重量によって一意に決まらない場合であっても、オペレータは、バケット１３３の交換に伴う作業機１３０の設定を容易に実施することができる。<br/>
  なお、第１の実施形態に係る制御装置においては、バケット１３３の種類情報をリストから選択するが、これに限られない。例えば、他の実施形態に係る制御装置においては、バケット１３３の種類情報がテキスト入力されてもよい。
</p>
<p num="0086">
  また、第１の実施形態に係る制御装置は、バケット情報記憶部１６５１が記憶する情報において、入力された種類情報に関連付けられた重量を特定し、特定した重量に関連付けられた相関データに基づいてコントロールバルブ１２４の制御量を決定する。つまり、第１の実施形態に係る制御装置は、作業機械１００の機種ごとに重量と相関データとの関係を記憶しておくことで、バケット１３３の設定を行うことができる。なお、他の実施形態においては、制御装置は、バケット１３３の種類情報と直接相関データとを直接関連付けたテーブルを記憶していてもよい。この場合、制御装置は、種類情報からバケット１３３の重量を特定する必要がない。また、他の実施形態の制御装置は、バケット１３３の種類情報と大、中、または小の重量の区分とを関連付けたテーブルを記憶していてもよい。また、他の実施形態において、制御装置は、バケット１３３の重量と制御量とを変数に持つ関数を用いることで、重量の区分を特定することなくバケット１３３を制御してもよい。
</p>
<p num="0087">
  また、第１の実施形態に係る制御装置においては、入出力装置１６０が、重量に基づいて大、中および小に係る重量の区分を特定し、作業機制御装置１５０が、当該区分に関連付けられた相関データに基づいてコントロールバルブ１２４の制御量を決定する。つまり、第１の実施形態に係る制御装置は、小、中および大の区分と相関データが関連付けられた従来の作業機制御装置１５０を変更することなく、バケット１３３の種類情報による設定を行うことができる。
</p>
<p num="0088">
  また、第１の実施形態に係る制御装置は、入力された種類情報に係るバケットの重量の入力を受け付け、バケット情報記憶部に、その種類情報と重量を関連付けて書き込む。これにより、制御装置は、バケットの種類情報および重量の入力を受け付けた以降、そのバケットの種類情報をリストに含めることができる。これにより、オペレータは、同じバケット１３３の２回目以降の交換時に、容易にバケット１３３の設定を行うことができる。なお、他の実施形態に係る制御装置は、予めバケット情報記憶部１６５１に複数のバケット１３３の情報を記憶させておき、新たなバケット１３３の情報の入力を受け付けないものであってもよい。
</p>
<p num="0089">
〈他の実施形態〉<br/>
  以上、図面を参照して一実施形態について詳しく説明してきたが、具体的な構成は上述のものに限られることはなく、様々な設計変更等をすることが可能である。<br/>
  例えば、上述した実施形態に係る制御装置は、作業機制御装置１５０と入出力装置１６０の組み合わせによって実現されるが、他の実施形態においてはこれに限られない。例えば、他の実施形態に係る制御装置は、１つの装置によって実現されてもよいし、３つ以上の装置の組み合わせによって実現されてもよい。また、作業機制御装置１５０の機能と入出力装置１６０の機能の組み合わせも、第１の実施形態の例に限られない。例えば、第１の実施形態に係る制御装置においては、入出力装置１６０がバケット情報記憶部１６５１、区分情報記憶部１６５２、および仕様記憶部１６５３を備えるが、他の実施形態に係る制御装置においては、バケット情報記憶部１６５１、区分情報記憶部１６５２、仕様記憶部１６５３のいずれか、または全部を作業機制御装置１５０が備えてもよい。また、作業機制御装置１５０が作業機械情報記憶部１５５１、目標施工データ記憶部１５５２、パラメータ記憶部１５５３を備えるが、他の実施形態に係る制御装置においては、作業機械情報記憶部１５５１、目標施工データ記憶部１５５２、パラメータ記憶部１５５３のいずれか、または全部を入出力装置１６０が備えてもよい。
</p>
<p num="0090">
  また、上述した実施形態に係る制御装置は、図８に示す介入制御と図９に示すバケットの表示制御とを行うが、これに限られない。例えば、他の実施形態に係る制御装置は、介入制御またはバケットの表示制御を行わないものであってもよい。制御装置が介入制御を行わない場合、作業機械１００は、位置方位演算器１４４、傾斜検出器１４５、作業機制御装置１５０を備えなくてもよい。制御装置がバケットの表示制御を行わない場合、作業機械１００は、入出力装置１６０を備えなくてもよい。
</p>
<p num="0091">
  また、他の実施形態に係る制御装置は、バケット１３３と設計面との関係を表示するものでなくてもよい。
</p>
<p num="0092">
  また、上述の実施形態に係るコントロールバルブ１２４は、制御線とアーム１３２とを描画した画像データの表示のために、アーム１３２の位置を車体座標系から現場座標系に変換するが、これに限られない。例えば、他の実施形態においては、コントロールバルブ１２４は、目標施工データが示す設計面の位置を現場座標系から車体座標系に変換してもよい。また、他の実施形態においては、コントロールバルブ１２４は、制御線およびアーム１３２の位置を、他の座標系に変換してもよい。
</p>
</description-of-embodiments>
<reference-signs-list>
<p num="0093">
１００…作業機械  １１０…走行体  １２０…旋回体  １３０…作業機  １３１…ブーム  １３２…アーム  １３３…バケット  １３４…ブームシリンダ  １３５…アームシリンダ  １３６…バケットシリンダ  １２４…コントロールバルブ  １５０…作業機制御装置  １５１１…操作量取得部  １５１２…検出情報取得部  １５１３…バケット位置特定部  １５１４…バケット位置通知部  １５１５…距離特定部  １５１６…制御線決定部  １５１７…目標速度演算部  １５１８…重量区分取得部  １５１９…パラメータ特定部  １５２０…制御指令生成部  １５２１…制御指令出力部  １５５１…作業機械情報記憶部  １５５２…目標施工データ記憶部  １５５３…パラメータ記憶部  １６０…入出力装置  １６１１…バケット情報入力部  １６１２…バケット選択部  １６１３…区分特定部  １６１４…区分通知部  １６１５…バケット位置取得部  １６１６…バケット位置表示部  １６５１…バケット情報記憶部  １６５２…区分情報記憶部  １６５３…仕様記憶部
</p>
</reference-signs-list>
</description><claims>
<claim num="1">
<claim-text>
  アタッチメントを有する作業機を制御する制御装置であって、<br/>
  前記アタッチメントを識別するための種類情報の入力を受け付ける種類情報入力部と、<br/>
  前記種類情報と、前記アタッチメントの重量または重量の区分との対応を予め記憶する記憶部と、<br/>
  前記種類情報入力部に入力される前記種類情報に基づいて、対応する重量または重量の区分を特定する特定部と、<br/>
  を備える制御装置。
</claim-text>
</claim>
<claim num="2">
<claim-text>
  前記アタッチメントは、前記作業機に取り付けられていた他のアタッチメントと形状が異なる<br/>
  請求項１に記載の制御装置。
</claim-text>
</claim>
<claim num="3">
<claim-text>
  前記特定部により特定された前記重量または前記重量の区分を、前記作業機の制御を行う制御部に送信する送信部と、<br/>
  を更に備える請求項１または請求項２に記載の制御装置。
</claim-text>
</claim>
<claim num="4">
<claim-text>
  前記記憶部は、前記作業機の仕様を記憶し、またアタッチメントの重量と重量の区分との対応を作業機の仕様毎に記憶し、<br/>
  前記特定部は、前記作業機の仕様と、特定された前記重量に基づいて、前記重量の区分を特定する<br/>
  請求項１から請求項３の何れか一項に記載の制御装置。
</claim-text>
</claim>
<claim num="5">
<claim-text>
  前記記憶部は、重量または重量の区分と、前記作業機の制御に関するパラメータとの対応を記憶し、<br/>
  前記送信部は、前記特定部により特定された前記重量また前記重量の区分に対応する前記作業機の制御に関するパラメータを、前記作業機の制御を行う制御部に送信する<br/>
  請求項３に記載の制御装置。
</claim-text>
</claim>
<claim num="6">
<claim-text>
  前記パラメータは、前記作業機を作動させるためのアクチュエータに供給する作動油の量を制御するバルブの開度に関するパラメータであって、<br/>
  前記制御部は、前記種類情報に関連付けられた前記パラメータに基づいて、前記バルブの制御量を決定する<br/>
  請求項５に記載の制御装置。
</claim-text>
</claim>
<claim num="7">
<claim-text>
  入力された前記種類情報に対応するアタッチメントの重量、または重量の区分の入力を受け付け、前記記憶部に、前記入力された種類情報と対応するアタッチメントの重量、または重量の区分を書き込む重量入力部<br/>
  を更に備える請求項１から請求項６の何れか一項に記載の制御装置。
</claim-text>
</claim>
<claim num="8">
<claim-text>
  作業機械が備えるアタッチメントの種類情報の入力を受け付けるステップと、<br/>
  前記種類情報と、前記アタッチメントの重量または重量の区分との対応を予め記憶する記憶部から、入力された前記種類情報に基づいて、対応する重量または重量の区分を特定するステップと<br/>
  を備える制御方法。
</claim-text>
</claim>
</claims><abstract>
  <p num="">【課題】アタッチメントの交換に伴う作業機の制御に係るパラメータの設定を容易に実施する。<br/>【解決手段】種類情報入力部は、アタッチメントを識別するための種類情報の入力を受け付ける。記憶部は、種類情報と、アタッチメントの重量または重量の区分との対応を予め記憶する。特定部は、種類情報入力部に入力される種類情報に基づいて、対応する重量または重量の区分を特定する。<br/>【選択図】図３</p>
</abstract><drawings>
<figure num="1">
<img id="000003" he="119" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="2">
<img id="000004" he="96" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="3">
<img id="000005" he="122" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="4">
<img id="000006" he="113" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="5">
<img id="000007" he="80" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="6">
<img id="000008" he="84" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="7">
<img id="000009" he="97" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="8">
<img id="000010" he="116" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="9">
<img id="000011" he="60" wi="85" file="2019206822.tif" img-format="tif" img-content="drawing"/>
</figure>
</drawings><jp:overflow><p num="">Ｆターム(参考) 2D003 AA01  AB04  AC06  BA01  BB02  BB03  CA02  CA10  DA04  DB01 <br/>                     DB05  FA02 <br/></p></jp:overflow></jp-official-gazette>
