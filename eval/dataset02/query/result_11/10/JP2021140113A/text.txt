<?xml version="1.0" encoding='utf-8'?>
<!-- <?xml-stylesheet type="text/xsl" href="../../../../../XSL/gat-a.xsl"?> -->
<!DOCTYPE jp-official-gazette PUBLIC "-//JPO//DTD PUBLISHED PATENT/UTILITY MODEL APPLICATION 1.0//EN" "../../../../../DTD/gat-a.dtd">
<jp-official-gazette kind-of-jp="A" kind-of-st16="A" lang="ja" dtd-version="1.0" country="JP" xmlns:jp="http://www.jpo.go.jp"><bibliographic-data lang="ja" country="JP">
    <publication-reference>
      <document-id>
        <country>JP</country>
        <doc-number>2021140113</doc-number>
        <kind>公開特許公報(A)</kind>
        <date>20210916</date>
      </document-id>
    </publication-reference>
    <application-reference>
      <document-id>
        <doc-number>2020040017</doc-number>
        <date>20200309</date>
      </document-id>
    </application-reference>
    <invention-title>地図データ記憶装置及び地図データ更新用コンピュータプログラム</invention-title>
    <parties>
      <jp:applicants-agents-article>
        <jp:applicants-agents sequence="1">
          <applicant sequence="1">
            <addressbook lang="ja">
              <name>トヨタ自動車株式会社</name>
              <registered-number>000003207</registered-number>
              <address>
                <text>愛知県豊田市トヨタ町１番地</text>
              </address>
            </addressbook>
          </applicant>
          <agent sequence="1" jp:kind="representative">
            <addressbook>
              <name>青木  篤</name>
              <registered-number>100099759</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
          <agent sequence="2" jp:kind="representative">
            <addressbook>
              <name>三橋  真二</name>
              <registered-number>100123582</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
          <agent sequence="3" jp:kind="representative">
            <addressbook>
              <name>鶴田  準一</name>
              <registered-number>100092624</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
          <agent sequence="4" jp:kind="representative">
            <addressbook>
              <name>伊藤  公一</name>
              <registered-number>100147555</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
          <agent sequence="5" jp:kind="representative">
            <addressbook>
              <name>関根  宣夫</name>
              <registered-number>100123593</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
          <agent sequence="6" jp:kind="representative">
            <addressbook>
              <name>河野  努</name>
              <registered-number>100133835</registered-number>
            </addressbook>
            <jp:attorney/>
          </agent>
        </jp:applicants-agents>
      </jp:applicants-agents-article>
      <inventors>
        <inventor sequence="1">
          <addressbook>
            <name>五十嵐  諒</name>
            <address>
              <text>東京都中央区日本橋室町三丁目２番１号  トヨタ・リサーチ・インスティテュート・アドバンスト・デベロップメント株式会社内</text>
            </address>
          </addressbook>
        </inventor>
      </inventors>
    </parties>
    <classification-ipc><edition/><main-clsf>G09B  29/00        20060101AFI20210820BHJP        </main-clsf><further-clsf>G01C  21/26        20060101ALI20210820BHJP        </further-clsf></classification-ipc>
    <classification-national><country>JP</country><main-clsf>G09B29/00 Z</main-clsf><further-clsf>G01C21/26 B</further-clsf></classification-national>
    <number-of-claims jp:adopted-law="claim">5</number-of-claims>
    <figure-to-publish>
      <fig-number>6</fig-number>
    </figure-to-publish>
    <jp:request-for-examination true-or-false="true"/>
    <jp:filing-form>ＯＬ</jp:filing-form>
    <jp:total-pages>20</jp:total-pages>
    <jp:theme-code-info>
      <jp:theme-code>2C032</jp:theme-code>
      <jp:theme-code>2F129</jp:theme-code>
    </jp:theme-code-info>
    <jp:f-term-info>
      <jp:f-term>2C032HB11</jp:f-term>
      <jp:f-term>2C032HB22</jp:f-term>
      <jp:f-term>2C032HC08</jp:f-term>
      <jp:f-term>2F129AA03</jp:f-term>
      <jp:f-term>2F129BB03</jp:f-term>
      <jp:f-term>2F129DD13</jp:f-term>
      <jp:f-term>2F129DD15</jp:f-term>
      <jp:f-term>2F129DD21</jp:f-term>
      <jp:f-term>2F129EE02</jp:f-term>
      <jp:f-term>2F129EE52</jp:f-term>
      <jp:f-term>2F129EE78</jp:f-term>
      <jp:f-term>2F129EE79</jp:f-term>
      <jp:f-term>2F129FF02</jp:f-term>
      <jp:f-term>2F129FF20</jp:f-term>
      <jp:f-term>2F129FF30</jp:f-term>
      <jp:f-term>2F129FF39</jp:f-term>
      <jp:f-term>2F129FF62</jp:f-term>
      <jp:f-term>2F129FF63</jp:f-term>
      <jp:f-term>2F129FF65</jp:f-term>
      <jp:f-term>2F129GG17</jp:f-term>
      <jp:f-term>2F129GG18</jp:f-term>
      <jp:f-term>2F129HH20</jp:f-term>
      <jp:f-term>2F129HH24</jp:f-term>
    </jp:f-term-info>
  </bibliographic-data><jp:image-of-bibliographic-data><img id="000001" he="140" wi="160" file="2021140113.tif" img-format="tif" img-content="drawing"/></jp:image-of-bibliographic-data><jp:image-of-chosen-drawing>
    <img id="000002" he="96" wi="69" file="2021140113.tif" img-format="tif" img-content="drawing"/>
  </jp:image-of-chosen-drawing><jp:abstract-correction/><description>

<technical-field>
<p num="0001">
  本発明は、地図データ記憶装置及び地図データ更新用コンピュータプログラムに関する。
</p>
</technical-field>
<background-art>
<p num="0002">
  車両の自動運転システムが車両を自動制御するために参照する高精度な道路の地図データには、道路に関する情報を正確に表していることが求められる。道路に関する情報は、車線の境界を表す車線区画線の位置及び交通規制に関する情報などを含むが、走行可能な車線は交通規制などにより変化し得るので、車両の自動運転システムが用いる地図データは、常に新しい状態にあることが好ましい。
</p>
<p num="0003">
  例えば、地図データを管理するサーバは、道路に関する情報を適宜収集し、この収集した情報を用いて地図データを更新する。車両の自動運転システムは、サーバから更新された地図データを受信し、この地図データを用いて車両の走行を自動制御する。
</p>
<p num="0004">
  例えば、特許文献１は、特定地域を１つ以上の縮尺で表現した１つ以上の物理レベルデータ、特定地域を一定のサイズで区分して示した１つ以上のタイルデータ及び１つの地図に表示される情報を区分して各々表示した１つ以上のレイヤデータを含む地図データを格納し、端末装置からのアップデート要請時に地図データをレベル、レイヤ、及びタイル単位のうち１つ以上の単位で提供するサービス装置と、内蔵された地図データを基盤に経路案内機能を実行し、且つ、アップデート条件によって、内蔵された地図データのうちアップデートする部分をレベル、レイヤ、及びタイル単位で決定し、サービス装置に要請し、決定された部分の地図データを受信し、内蔵された地図データに反映する端末装置と、を含むリアルタイム地図データアップデートシステムを提案している。
</p>
</background-art>
<citation-list>
<patent-literature>
<p num="0005">
<patcit num="1"><text>特表２０１４−５０３８３４号公報</text></patcit>
</p>
</patent-literature>
</citation-list>
<summary-of-invention>
<tech-problem>
<p num="0006">
  車両の自動運転システムが用いる地図データは、道路に関する多くの情報を含むので、車両がサーバから地図データを受信することは、大きな通信負荷を発生する。
</p>
<p num="0007">
  また、特許文献１が提案するリアルタイム地図データアップデートシステムでは、アップデート条件によりアップデートされる情報量が削減される。しかし、アップデート条件によっては、通信負荷の低減が十分ではないおそれがある。
</p>
<p num="0008">
  そこで、本発明は、走行予定経路と関係する地図データを新しい状態に更新すると共に、通信負荷を低減できる地図データ記憶装置を提供することを目的とする。
</p>
</tech-problem>
<tech-solution>
<p num="0009">
  一の実施形態によれば、地図データ記憶装置が提供される。この地図データ更新装置は、車両が走行を開始する前に通信部を介してサーバから受信した地図データを、初期地図データとして記憶する記憶部と、車両が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバにおいて更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、通信部を介してサーバへ送信する更新要求部と、通信部を介して受信した更新情報を用いて、初期地図データを更新する更新部と、を有する。
</p>
<p num="0010">
  この地図データ記憶装置において、地図データは、サーバにおいて第１の更新周期で情報が更新される第１地図データと、サーバにおいて第１の更新周期よりも短い第２の更新周期で情報が更新される第２地図データとを有し、更新要求部は、走行予定経路に含まれる複数の道路区間のそれぞれについて、車両が当該道路区間に到達する前に、当該道路区間と関連づけられている第１地図データの更新情報の要求を、第２地図データの更新情報よりも前に通信部を介してサーバへ送信することが好ましい。
</p>
<p num="0011">
  また、この地図データ記憶装置において、地図データは、基本データと、当該基本データに対して更新された情報を有する更新データとを有し、更新部は、走行予定経路に含まれる複数の道路区間のそれぞれのうち、更新情報を要求した当該道路区間について、サーバにおいて更新された更新データにおける道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報を用いて、初期地図データを更新することが好ましい。
</p>
<p num="0012">
  また、この地図データ記憶装置において、地図データが有する複数の情報のそれぞれは、当該情報が更新された更新日時と関連付けられており、記憶部は、サーバが地図データを車両に送信した送信日時を、初期地図データの送信日時として、初期地図データと共に記憶し、更新要求部は、初期地図データの送信日時を、更新情報の要求と共に、通信部を介してサーバへ送信し、更新部は、走行予定経路に含まれる複数の道路区間のそれぞれのうち、更新情報を要求した当該道路区間について、サーバにおいて更新された地図データにおける道路区間と関連付けられている情報のうち、初期地図データの送信日時よりも後に更新された情報を含む更新情報を用いて、初期地図データを更新することが好ましい。
</p>
<p num="0013">
  他の実施形態によれば、地図データ更新用コンピュータプログラムが提供される。この地図データ更新用コンピュータプログラムは、車両が走行を開始する前に通信部を介してサーバから受信した地図データを、初期地図データとして記憶部に記憶させ、車両が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバにおいて更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、通信部を介してサーバへ送信し、通信部を介して受信した更新情報を用いて、初期地図データを更新する、ことをプロセッサに実行させる。
</p>
</tech-solution>
<advantageous-effects>
<p num="0014">
  本発明に係る地図データ記憶装置は、走行予定経路と関係する地図データを新しい状態に更新すると共に、通信負荷を低減できるという効果を奏する。
</p>
</advantageous-effects>
</summary-of-invention>
<description-of-drawings>
<p num="0015">
<figref num="1">地図データ記憶装置が実装される地図データ更新システムの概略構成図である。</figref>
<figref num="2">地図データ更新処理のシーケンス図である。</figref>
<figref num="3">地図データを説明する図である。</figref>
<figref num="4">車両の概略構成図である。</figref>
<figref num="5">地図データ記憶装置のハードウェア構成図である。</figref>
<figref num="6">地図データ記憶装置のプロセッサの機能ブロック図である。</figref>
<figref num="7">地図データ記憶装置のプロセッサの地図データ取得部の動作フローチャートである。</figref>
<figref num="8">地図データ記憶装置のプロセッサの更新要求部の動作フローチャートである。</figref>
<figref num="9">車両の走行予定経路を説明する図である。</figref>
<figref num="10">地図データ記憶装置のプロセッサの更新部の動作フローチャートである。</figref>
<figref num="11">サーバのハードウェア構成図である。</figref>
<figref num="12">サーバのプロセッサの機能ブロック図である。</figref>
<figref num="13">地図データ更新処理のうちのサーバの更新情報生成部において実行される処理の動作フローチャートである。</figref>
</p>
</description-of-drawings>
<description-of-embodiments>
<p num="0016">
  以下、図を参照しつつ、本実施形態の地図データ記憶装置について説明する。この地図データ記憶装置は、車両が走行を開始する前にサーバから受信した地図データを、初期地図データとして記憶し、車両が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバにおいて更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、サーバへ送信する。そして、この地図データ記憶装置は、受信した更新情報を用いて、初期地図データを更新する。これにより、走行予定経路と関係する地図データを新しい状態に更新すると共に、通信負荷を低減できる。
</p>
<p num="0017">
  図１は、地図データ更新装置が実装される地図データ更新システムの概略構成図である。本実施形態では、地図データ更新システム１は、地図データ更新装置が実装される、少なくとも一つの車両２と、サーバ３とを有する。車両２は、例えば、サーバ３が接続される通信ネットワーク４とゲートウェイ（図示せず）などを介して接続されるマクロセルを提供する無線基地局５（以下、マクロセル基地局５ともいう）にアクセスすることで、マクロセル基地局５及び通信ネットワーク４を介してサーバ３と接続される。また、車両２は、例えば、車両２がユーザの自宅の駐車場に駐車している時には、サーバ３が接続される通信ネットワーク４とゲートウェイ（図示せず）などを介して接続されるスモールセルを提供する無線基地局６（以下、スモールセル基地局５ともいう）に、無線通信又は有線通信を用いてアクセスすることで、スモールセル基地局６及び通信ネットワーク４を介してサーバ３と接続される。なお、図１では、一つの車両２のみが図示されているが、地図データ更新システム１は複数の車両２を有してもよい。同様に、複数のマクロセル基地局５又はスモールセル基地局６が通信ネットワーク４に接続されていてもよい。
</p>
<p num="0018">
  図２は、地図データ更新処理のシーケンス図である。地図データ更新システム１は、車両２が、走行を開始する前、及び、車両が走行予定経路に沿って走行を開始した後、図２に示されるシーケンス図に従って地図データ更新処理を実行すればよい。
</p>
<p num="0019">
  車両２は、走行を開始する前に、地図データの送信を求める地図データ要求を、スモールセル基地局６及び通信ネットワーク４を介してサーバ３へ送信する（ステップＳ１０１）。車両２は、走行を開始する前に、例えば出発地であるユーザの自宅の駐車場において、地図データ要求をサーバ３へ送信する。
</p>
<p num="0020">
  サーバ３は、地図データを記憶し、且つ、地図データを更新する。地図データは、車両２の走行を制御するために用いられる道路に関する高精度な地図情報である。具体的には、地図データは、地図に表される個々の道路の走行条件を規定する道路特徴物（例えば、車線区画線、一時停止線、速度表示といった道路標示、道路標識又は信号機など）の位置及び種類を有する。また、地図データは、交通規制に関する情報、事故の関する情報、他の車両、歩行者に関する情報、及び信号に関する情報を有していてもよい。地図データが有する複数の道路特徴物のそれぞれは、道路に含まれる車線を識別する識別情報である車線ＩＤと関連付けられている。また、車線ＩＤは、道路区間を識別する識別情報である道路区間ＩＤと関連付けられている。ある道路区間が複数の車線を有する場合、そのある道路区間ＩＤに複数の車線ＩＤが関連付けられる。地図データが有する道路特徴物のそれぞれは、車線ＩＤを介して、道路区間ＩＤと関連付けられている。車両２の現在位置から目的地までの走行予定経路は、現在位置から目的地までに車両２が走行する道路区間が連結して生成される。道路特徴物と同様に、地図データに含まれる交通規制に関する情報、事故に関する情報、他の車両、歩行者に関する情報、及び信号に関する情報なども、車線ＩＤと関連付けられており、この車線ＩＤを介して道路区間ＩＤと関連付けられている。地図データが表す地域は、国、複数の都道府県を含む領域などであってもよい。車両２は、地図データ要求を送信する時に、マクロセル基地局５及び通信ネットワーク４を介してサーバ３と通信してもよいが、スモールセル基地局６は車両２を含む比較的少数の相手とのみ通信を行うので、車両２は、スモールセル基地局６及び通信ネットワーク４を介してサーバ３と通信する方が、大容量の通信回線を用いて高速に且つ安価に通信可能な観点から好ましい。
</p>
<p num="0021">
  図３は、地図データを説明する図である。地図データ３００は階層構造を有する。具体的には、地図データ３００には、静的な情報を含む第１層３０１と、准静的な情報を含む第２層３０２と、准動的な情報を含む第３層３０３と、動的な情報を含む第４層３０４の４個の層が含まれている。第１層３０１は、第１地図データの一例であり、この場合、第２層３０２、第３層３０３及び第４層３０４は、第２地図データの一例である。サーバ３は、道路に関する情報を適宜収集し、地図データの各層の情報を更新している。サーバ３は、各層が有する情報の時間変化の程度に対応させて、各層の更新周期を変えている。第１層３０１、第２層３０２、第３層３０３、第４層３０４の順番に更新周期は短くなる。第１層３０１に含まれる静的な情報には、例えば、道路標示又は道路標識などの地物に関する情報及び車線に関する情報といった、基本的には変化しないものに関する情報が含まれる。そのため、第１層３０１に含まれる静的な情報は、比較的長い周期（例えば、１時間〜１ヶ月）ごとに更新されればよい。また、第２層３０２に含まれる准静的な情報には、交通規制に関する情報、道路工事に関する情報及び広域気象情報といった、ある程度は継続するものの、静的な情報よりも短い期間で変更される可能性があるものに関する情報が含まれる。そのため、第２層３０２に含まれる准静的な情報は、第１層３０１に含まれる静的な情報の更新周期よりも短い周期（例えば、３０分〜１時間）ごとに更新されればよい。さらに、第３層３０３に含まれる准動的な情報には、事故に関する情報、渋滞に関する情報及び狭域気象情報といった、准静的な情報よりも短い期間で変化する可能性があるものに関する情報が含まれる。そのため、第３層３０３に含まれる准動的な情報は、第２層３０２に含まれる准静的な情報の更新周期よりも短い周期（例えば、１分〜３０分間）ごとに更新されればよい。さらにまた、第４層３０４に含まれる動的な情報には、車両の位置、歩行者の位置に関する情報及び信号に関する情報といった、リアルタイムで変化する可能性があるものに関する情報が含まれる。そのため、第４層３０４に含まれる動的な情報は、例えば、リアルタイムで更新されることが好ましい。
</p>
<p num="0022">
  また、地図データ３００は、基本データ３００ａと、この基本データ３００ａに対して更新された情報を有する更新データ３００ｂとを有する。具体的には、第１層３０１は、第１層３０１の基本データ３０１ａと、この基本データ３０１ａに対して更新された情報を有する更新データ３０１ｂとを有する。第２層３０２は、第２層３０２の基本データ３０２ａと、この基本データ３０２ａに対して更新された情報を有する更新データ３０２ｂとを有する。第３層３０３は、第３層３０３の基本データ３０３ａと、この基本データ３０３ａに対して更新された情報を有する更新データ３０３ｂとを有する。第４層３０４は、第４層３０４の基本データ３０４ａと、この基本データ３０４ａに対して更新された情報を有する更新データ３０４ｂとを有する
</p>
<p num="0023">
  サーバ３は、地図データ送信要求を受信すると、現時点の地図データ３００として、基本データ３００ａ及び更新データ３００ｂを合わせた新たな地図データを生成し、この地図データを、通信ネットワーク４及びスモールセル基地局６を介して車両２へ送信する（ステップＳ１０２）。
</p>
<p num="0024">
  車両２は、走行を開始する前に、受信した地図データを初期地図データとして記憶する（ステップＳ１０３）。そして、車両２は、車両２のナビゲーション装置により生成された走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバ３において更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報を要求する更新要求を生成する（ステップＳ１０４）。車両２は、この更新要求を、マクロセル基地局５及び通信ネットワーク４を介してサーバ３へ送信する（ステップＳ１０５）。なお、車両２が出発地を出発して最初に走行する道路区間と関連付けられている情報は、走行を開始する前に記憶した初期地図データの情報となる。
</p>
<p num="0025">
  サーバ３は、現時点の地図データの更新データを含む更新情報を生成し、この更新情報を、通信ネットワーク４及びマクロセル基地局５を介して車両２へ送信する（ステップＳ１０６）。更新要求が、地図データの第１層〜第４層のうちの何れかの層における更新された情報を求めている場合、サーバ３は、更新要求により特定される層の更新データを含む更新情報を生成してもよい。
</p>
<p num="0026">
  車両２は、サーバ３から送信された更新情報を用いて、サーバ３において更新された更新データにおける道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報を用いて、初期地図データを更新する（ステップＳ１０７）。この更新された初期地図データを用いて、走行予定経路に含まれる道路区間における車両２の走行が制御される。上述した地図データ更新処理は、車両２が目的地へ到達するまで繰り返される。
</p>
<p num="0027">
  次に、車両２について説明する。上記のように、地図データ更新システム１には、車両２が複数含まれてもよいが、地図データ更新処理に関して各車両２は同じ構成を有し、かつ同じ処理を実行すればよいので、以下では、一つの車両２について説明する。
</p>
<p num="0028">
  図４は、車両２の概略構成図である。車両２は、車両２の前方の環境を撮影するカメラ１１と、無線通信端末１２と、測位情報受信機１３と、地図データ更新装置の一例である地図データ記憶装置１４と、ナビゲーション装置１５と、車両制御装置１６とを有する。さらに、車両２は、LIDARセンサといった、車両２の周囲の物体までの距離を測定するための測距センサ（図示せず）をさらに有してもよい。
</p>
<p num="0029">
  カメラ１１と、無線通信端末１２と、地図データ記憶装置１４と、ナビゲーション装置１５と、車両制御装置１６と、地図データ記憶装置１４とは、コントローラエリアネットワークといった規格に準拠した車内ネットワークを介して通信可能に接続される。
</p>
<p num="0030">
  カメラ１１は、車両２の前方を向くように、例えば、車両２の車室内に取り付けられる。カメラ１１は、所定の周期で設定されるカメラ画像取得時刻において、車両２の前方の所定の領域が表されたカメラ画像を生成する。生成されたカメラ画像には、車両２の周囲の他の車両又は車両２の前方の所定の領域内に含まれる路面上の車線区画線などの道路特徴物が表わされる。カメラ１１により生成される画像は、カラー画像であってもよく、又は、グレー画像であってもよい。カメラ１１は、撮像部の一例であり、ＣＣＤあるいはＣ−ＭＯＳなど、可視光に感度を有する光電変換素子のアレイで構成された２次元検出器と、その２次元検出器上に撮影対象となる領域の像を結像する撮像光学系を有する。カメラ１１は、カメラ画像を生成する度に、カメラ画像及びカメラ画像を生成したカメラ画像取得時刻を、車内ネットワークを介して車両制御装置１６へ出力する。カメラ画像は、車両制御装置１６において、車両の現在位置を推定する処理に使用されるのと共に、車両２の周囲の他の物体を検出する処理に使用される。
</p>
<p num="0031">
  無線通信端末１２は、通信部の一例であり、所定の無線通信規格に準拠した無線通信処理を実行する機器であり、例えば、マクロセル基地局５又はスモールセル基地局６にアクセスすることで、マクロセル基地局５及び通信ネットワーク４又はスモールセル基地局６及び通信ネットワーク４を介してサーバ３と接続される。そして無線通信端末１２は、サーバ３から受信した、地図データ又は更新情報を含むダウンリンクの無線信号を受信し、その地図データ又は更新情報を地図データ記憶装置１４などへ出力する。また、無線通信端末１２は、地図データ記憶装置１４から受け取った地図データ要求又は更新要求などを含むアップリンクの無線信号を生成する。そして無線通信端末１２は、そのアップリンクの無線信号をマクロセル基地局５又はスモールセル基地局６へ送信することで、地図データ要求又は更新要求などをサーバ３へ送信する。また、無線通信端末１２は、所定の有線通信規格に準拠した有線通信処理を実行する機器であり、スモールセル基地局６に有線で接続可能であることが好ましい。
</p>
<p num="0032">
  測位情報受信機１３は、車両２の現在位置を表す測位情報を出力する。例えば、測位情報受信機１３は、ＧＰＳ受信機とすることができる。測位情報受信機１３は、所定の受信周期で測位情報を取得する度に、測位情報及び測位情報を取得した測位情報取得時刻を、地図データ記憶装置１４へ出力する。
</p>
<p num="0033">
  ナビゲーション装置１５は、ナビゲーション用地図データと、車両２の目的地と、車両２の現在位置とに基づいて、車両２の現在位置から目的地までの走行予定経路を生成する。ナビゲーション装置１５は、測位情報受信機１３が出力した測位情報及び測位情報取得時刻を、地図データ記憶装置１４を介して入力して、車両２の現在位置として用いる。ナビゲーション装置１５は、走行予定経路を生成する度に、その走行予定経路を、車内ネットワークを介して車両制御装置１６及び地図データ記憶装置１４へ出力する。
</p>
<p num="0034">
  車両制御装置１６は、車両２の走行を制御する。車両制御装置１６は、測位情報、カメラ画像及び地図情報などを用いて、車両の現在位置を推定する。車両制御装置１６は、測位情報受信機１３が出力した測位情報及び測位情報取得時刻を、地図データ記憶装置１４を介して入力する。また、車両制御装置１６は、地図データ記憶装置１４から、車両２の現在位置を含む地図情報を入力する。また、車両制御装置１６は、カメラ画像を用いて、車両２の周囲の他の物体を検出する。また、車両制御装置１６は、車両２の現在位置と、車両２の走行予定経路と、車両２の周囲の他の物体などに基づいて運転計画を生成し、この運転計画に基づいて車両２の走行を制御する。
</p>
<p num="0035">
  図５は、地図データ記憶装置１４のハードウェア構成図である。地図データ記憶装置１４は、車両２が走行を開始する前に無線通信端末１２を介してサーバ３から受信した地図データを、初期地図データとして記憶する。また、地図データ記憶装置１４は、車両２が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバ３において更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、無線通信端末１２を介してサーバ３へ送信する。また、地図データ記憶装置１４は、無線通信端末１２を介して受信した更新情報を用いて、初期地図データを更新する。本明細書では、更新情報を用いて、情報が更新された初期地図データを、更新された初期地図データともいう。さらに、本明細書では、更新情報を用いて、更新された初期地図データが、さらに更新された後の更新された初期地図データを、単に更新された初期地図データともいう。また、地図データ記憶装置１４は、測位情報に基づいて、初期地図データ又は更新された初期地図データを参照して、測位情報により表される現在位置を含む領域の地図情報を生成する。そのために、地図データ記憶装置１４は、通信インターフェース２１と、ストレージ装置２２と、メモリ２３と、プロセッサ２４とを有する。
</p>
<p num="0036">
  通信インターフェース（Ｉ／Ｆ）２１は、車内通信部の一例であり、地図データ記憶装置１４を車内ネットワークに接続するためのインターフェース回路を有する。すなわち、通信インターフェース２１は、車内ネットワークを介して、無線通信端末１２と、測位情報受信機１３と、ナビゲーション装置１５と、車両制御装置１６などと接続される。通信インターフェース２１は、例えば、測位情報受信機１３から測位情報及び測位情報取得時刻を受信する度に、受信した測位情報及び測位情報取得時刻をプロセッサ２４へわたす。また、通信インターフェース２１は、ナビゲーション装置１５から走行予定経路を受信する度に、受信した走行予定経路をプロセッサ２４へわたす。また、通信インターフェース２１は、プロセッサ２４から受け取った地図データ要求及び更新要求を、車内ネットワークを介して無線通信端末１２へ送信する。さらに、通信インターフェース２１は、無線通信端末１２から受信した地図データ及び更新情報をプロセッサ２４へわたす。
</p>
<p num="0037">
  ストレージ装置２２は、記憶部の一例であり、例えば、ハードディスク装置又は光記録媒体及びそのアクセス装置を有する。そしてストレージ装置２２は、車両２が走行を開始する前に無線通信端末１２を介してサーバ３から受信した地図データを、初期地図データ２２１として記憶する。また、プロセッサ２４により更新された初期地図データ２２１などを記憶する。
</p>
<p num="0038">
  メモリ２３は、記憶部の一例であり、例えば、揮発性の半導体メモリ及び不揮発性の半導体メモリを有する。そしてメモリ２３は、地図データ記憶装置１４のプロセッサ２４により実行される情報処理において使用されるアプリケーションのコンピュータプログラム及び各種のデータ、車両２を識別する車両ＩＤなどを記憶する。車両ＩＤは、例えば、サーバ３が複数の車両２と通信を行う場合に、各車両２を識別するのに使用できる。
</p>
<p num="0039">
  プロセッサ２４は、１個又は複数個のＣＰＵ（Ｃｅｎｔｒａｌ  Ｐｒｏｃｅｓｓｉｎｇ  Ｕｎｉｔ）及びその周辺回路を有する。プロセッサ２４は、論理演算ユニット、数値演算ユニットあるいはグラフィック処理ユニットといった他の演算回路をさらに有していてもよい。プロセッサ２４が複数個のＣＰＵを有する場合、ＣＰＵごとにメモリを有していてもよい。プロセッサ２４は、車両２が走行を開始する前に、地図データ要求を生成する。また、プロセッサ２４は、車両２が走行を開始した後に、地図データ更新に関連する処理を実行する。また、プロセッサ２４は、測位情報に基づいて地図情報を生成する。
</p>
<p num="0040">
  図６は、地図データ記憶装置１４のプロセッサ２４の機能ブロック図である。プロセッサ２４は、地図データ取得部３１と、更新要求部３２と、更新部３３と、地図情報生成部３４とを有する。プロセッサ２４が有するこれらの各部は、例えば、プロセッサ２４上で動作するコンピュータプログラムにより実現される機能モジュールである。あるいは、プロセッサ２４が有するこれらの各部は、プロセッサ２４に設けられる、専用の演算回路であってもよい。
</p>
<p num="0041">
  地図データ取得部３１は、車両２が走行を開始する前に、無線通信端末１２を介して地図データを求める地図データ要求を、通信インターフェース２１を用いて、スモールセル基地局６及び通信ネットワーク４を介してサーバ３へ送信する。そして、地図データ取得部３１は、サーバ３から受信した地図データを、初期地図データ２２１として、ストレージ装置２２に記憶させる。本明細書において車両２の走行開始前は、車両２が単に停車している状態ではなく、地図データ記憶装置１４が起動しており、車両２まもなく走行を開始する状態にあることを意味する。車両２の地図データ取得部３１は、例えば、通信インターフェース２１を介して車両２のイグニッションスイッチがオンにされたことを示すオン信号を受信すると、車両２が走行開始前であると判定する。また、地図データ取得部３１は、通信インターフェース２１を介して、ナビゲーション装置１５が生成した走行予定経路が、ユーザにより承認されたことを示す経路承認信号を受信すると、車両２が走行開始前であると判定する。
</p>
<p num="0042">
  図７は、地図データ記憶装置１４のプロセッサ２４の地図データ取得部３１の動作フローチャートである。まず、地図データ取得部３１は、現時点の地図データを求める地図データ要求を、通信インターフェース２１を介して無線通信端末１２へ送信する（ステップＳ２０１）。無線通信端末１２は、地図データ要求を、スモールセル基地局６及び通信ネットワーク４を介してサーバ３へ送信する。
</p>
<p num="0043">
  次に、地図データ取得部３１は、サーバ３から無線通信端末１２を介して受け取った地図データを、初期地図データ２２１としてストレージ装置２２に記憶させる（ステップＳ２０２）。地図データ記憶装置１４がすでに他の初期地図データ又は他の更新された初期地図データを記憶していた場合、この他の初期地図データ又は他の更新された初期地図データは古い地図データなので、地図データ取得部３１は、古い初期地図データを新たな初期地図データに置き換えて地図データ記憶装置１４に記憶させる。
</p>
<p num="0044">
  更新要求部３２は、車両２が走行予定経路に沿って走行を開始した後、更新情報の要求を、無線通信端末１２を介してサーバ３へ送信する。更新要求部３２は、例えば、測位情報に基づいて車両２の現在位置を取得し、車両２の現在位置が出発地から所定の距離だけ離れた場合、車両２が走行予定経路に沿って走行を開始したと判定する。なお、更新要求部３２は、車両制御装置１６から車両２の現在位置を受け取るようにしてもよい。
</p>
<p num="0045">
  図８は、地図データ記憶装置１４のプロセッサ２４の更新要求部３２の動作フローチャートである。図９は、車両２の走行予定経路を説明する図である。車両２の走行予定経路は、出発地７０１と地点Ｌ１との間の道路区間Ｒ１と、地点Ｌ１と地点Ｌ２との間の道路区間Ｒ２と、地点Ｌ２と地点Ｌ３との間の道路区間Ｒ３と、地点Ｌ３と目的地７０２との間の道路区間Ｒ４とを含む。走行予定経路は、道路区間Ｒ１と、道路区間Ｒ２と、道路区間Ｒ３と、道路区間Ｒ４とが連結して形成される。更新要求部３２は、車両２が走行予定経路に沿って走行を開始した後、目的地に到着するまで図８に示す動作を実行する。更新要求部３２は、車両２が走行予定経路に含まれるある道路区間に到達する前に、そのある道路区間と関連づけられている第１層の更新情報を、第２層、第３層及び第４層の更新情報よりも前に無線通信端末１２を介してサーバ３へ要求する。まず、更新要求部３２は、車両２の現在位置及び走行予定経路に基づいて、車両２が次に走行する予定の道路区間（以下、次道路区間ともいう）へ到達する予定到達時刻を求める（ステップＳ３０１）。例えば、更新要求部３２は、出発地７０１を出発時刻Ｔ１に出発して道路区間Ｒ１を走行している間に、車両２が次に走行する予定の道路区間Ｒ２（地点Ｌ１）へ到達する予定到達時刻Ｔ２を求める。更新要求部３２は、例えば、通信インターフェース２１を介して車両２の車両速度を受信して、過去の所定の時間の平均の車両速度と、車両２の現在位置と地点Ｌ１との間の距離に基づいて、予定到達時刻Ｔ２を求める。同様に、更新要求部３２は、道路区間Ｒ２を走行している間に、車両２が次に走行する予定の道路区間Ｒ３（地点Ｌ２）へ到達する予定到達時刻Ｔ３を求める。また、更新要求部３２は、道路区間Ｒ３を走行している間に、車両２が次に走行する予定の道路区間Ｒ４（地点Ｌ３）へ到達する予定到達時刻Ｔ４を求める。なお、更新要求部３２は、現在の道路区間の走行中に、２又は３以上先に走行を予定している道路区間に到達する到達予定時刻を求めるようにしてもよい。
</p>
<p num="0046">
  次に、更新要求部３２は、現時刻は車両２が次道路区間への到着予定時刻に対して第１時間前になったか否かを判定する（ステップＳ３０２）。更新要求部３２は、現時刻が車両２が次道路区間への到着予定時刻に対して第１時間以内になっていれば（ステップＳ３０２−Ｙｅｓ）、地図データの第１層を表す情報及び次道路区間を表す道路区間ＩＤを含む更新要求を生成する。更新要求部３２は、例えば、道路区間Ｒ１の走行中に、道路区間Ｒ２への到着予定時刻に対して第１時間前になったか否かを判定する。現時刻が車両２が次道路区間への到着予定時刻に対して第１時間前になった場合、更新要求部３２は、次道路区間について、サーバ３において更新された地図データにおける次道路区間と関連付けられている情報のうち、次道路区間と関連づけられている初期地図データ２２１の第１層の更新情報の要求を求める更新要求を生成し、この更新要求を無線通信端末１２を用いて、マクロセル基地局５及び通信ネットワーク４を介してサーバ３へ送信する（ステップＳ３０３）。地図データの第１層の情報は、静的な情報であり、基本的には変化しないものに関する情報である。そのため、地図データの第１層の情報は、車両２が次道路区間に到達する直前の時刻でも又は比較的手前の時刻でもあまり変化はないと推定される。第１時間としては、例えば、１時間としてもよい。一方、現時刻が次道路区間への到着予定時刻に対して第１時間前ではないと判定された場合（ステップＳ３０２−Ｎｏ）、地図データ取得部３１は、所定の時間間隔をおいて、ステップＳ３０２の判定を実行する。
</p>
<p num="0047">
  次に、更新要求部３２は、現時刻は車両２が次道路区間への到着予定時刻に対して、第１時間よりも短い第２時間前になったか否かを判定する（ステップＳ３０４）。更新要求部３２は、現時刻が車両２が次道路区間への到着予定時刻に対して第２時間以内になっていれば（ステップＳ３０４−Ｙｅｓ）、地図データの第２層を表す情報及び次道路区間を表す道路区間ＩＤを含む更新要求を生成する。更新要求部３２は、例えば、道路区間Ｒ１の走行中に、道路区間Ｒ２への到着予定時刻に対して第２時間前になったか否かを判定する。現時刻が車両２が次道路区間への到着予定時刻に対して第２時間前になった場合、更新要求部３２は、次道路区間について、サーバ３において更新された地図データにおける次道路区間と関連付けられている情報のうち、次道路区間と関連づけられている初期地図データ２２１の第２層の更新情報の要求を求める更新要求を生成し、この更新要求を無線通信端末１２を用いて、マクロセル基地局５及び通信ネットワーク４を介してサーバ３へ送信する（ステップＳ３０５）。地図データの第２層の情報は、准静的な情報であり、ある程度は継続するものの、静的な情報よりも短い期間で変更される可能性があるものに関する情報である。そのため、地図データの第２層の情報は、車両２が次道路区間に到達する直前の時刻でも又は比較的手前の時刻でも大きな変化はないと推定される。第２時間としては、例えば、サーバ３における第１層の更新周期以下の３０分〜１時間としてもよい。一方、現時刻が次道路区間への到着予定時刻に対して第２時間前ではないと判定された場合（ステップＳ３０４−Ｎｏ）、地図データ取得部３１は、所定の時間間隔をおいて、ステップＳ３０４の判定を実行する。
</p>
<p num="0048">
  次に、更新要求部３２は、現時刻は車両２が次道路区間への到着予定時刻に対して、第２時間よりも短い第３時間前になったか否かを判定する（ステップＳ３０６）。更新要求部３２は、現時刻が車両２が次道路区間への到着予定時刻に対して第３時間以内になっていれば（ステップＳ３０６−Ｙｅｓ）、地図データの第３層を表す情報及び次道路区間を表す道路区間ＩＤを含む更新要求を生成する。更新要求部３２は、例えば、道路区間Ｒ１の走行中に、道路区間Ｒ２への到着予定時刻に対して第３時間前になったか否かを判定する。現時刻が車両２が次道路区間への到着予定時刻に対して第３時間前になった場合、更新要求部３２は、次道路区間について、サーバ３において更新された地図データにおける次道路区間と関連付けられている情報のうち、次道路区間と関連づけられている初期地図データ２２１の第３層の更新情報の要求を求める更新要求を生成し、この更新要求を無線通信端末１２を用いて、マクロセル基地局５及び通信ネットワーク４を介してサーバ３へ送信する（ステップＳ３０７）。地図データの第３層の情報は、准動的な情報であり、准静的な情報よりも短い期間で変化する可能性があるものに関する情報である。そのため、地図データの第３層の情報は、車両２が次道路区間に到達する直前の時刻と比較的手前の時刻とでは、変化し得ると推定される。第３時間としては、例えば、サーバ３における第２層の更新周期以下の１分〜３０分としてもよい。一方、現時刻が次道路区間への到着予定時刻に対して第３時間前ではないと判定された場合（ステップＳ３０６−Ｎｏ）、地図データ取得部３１は、所定の時間間隔をおいて、ステップＳ３０６の判定を実行する。また、更新要求部３２は、車両２が現在走行中の道路区間（以下、現道路区間ともいう）について、更新された地図データにおける現道路区間と関連付けられている情報のうち、現道路区間と関連づけられている初期地図データ２２１の第３層の更新情報の要求を求める更新要求を、無線通信端末１２を介してサーバ３へ送信してもよい。上述したように、地図データの第３層の情報は准動的な情報であるので、地図データ取得部３１は、現在走行中の道路区間についても、地図データの第３層の情報の更新を随時実行することが好ましい。
</p>
<p num="0049">
  また、更新要求部３２は、所定の時間間隔（例えば、サーバ３における第３層の更新周期以下の１分）で、車両２が現在走行中の現道路区間について、サーバ３において更新された地図データにおける現道路区間と関連付けられている情報のうち、現道路区間と関連づけられている初期地図データ２２１の第４層の更新情報の要求を求める更新要求を生成し、この更新要求を無線通信端末１２を用いて、マクロセル基地局５及び通信ネットワーク４を介してサーバ３へ送信する。地図データの第４層の情報は、動的な情報であり、リアルタイムで変化する可能性があるものに関する情報である。そのため、更新要求部３２は、現在走行中の道路区間に対して、地図データの第４層の情報の更新を随時実行することが好ましい。
</p>
<p num="0050">
  更新部３３は、無線通信端末１２を介して受信した更新情報を用いて、走行予定経路に含まれる複数の道路区間のそれぞれのうち、更新情報を要求した道路区間について、初期地図データ２２１を更新する。本明細書では、更新部３３が、更新情報を用いて、初期地図データ２２１を更新することは、更新部３３が、更新情報を用いて、更新された初期地図データ２２１をさらに更新することを含む。
</p>
<p num="0051">
  図１０は、地図データ記憶装置１４のプロセッサ２４の更新部３３の動作フローチャートである。更新部３３は、無線通信端末１２を介して受信した更新情報を用いて、車両２が走行を開始する前に受信された初期地図データ２２１を更新する。まず、更新部３３は、無線通信端末１２を介してサーバ３から地図データの更新情報を受信したか否かを判定する（ステップＳ４０１）。上述したように、更新要求が、地図データの第１層〜第４層のうちの何れかの層における更新された情報を求めている場合、サーバ３は、更新要求により特定される層の更新データのうち更新要求により特定される道路区間に関する情報と、更新要求により特定される層を表す情報と、更新要求により特定される道路区間ＩＤとを含む更新情報を生成する。この更新情報は、更新要求により特定される層の更新データのうち、更新要求により特定される道路区間のみの情報を含む。地図データの更新情報を受信している場合（ステップＳ４０１−Ｙｅｓ）、更新部３３は、サーバ３において更新された地図データの更新データにおける道路区間と関連付けられている情報のうち、受信された更新情報を用いて、更新情報により特定される層における、更新情報に含まれる道路区間ＩＤにより識別される道路区間について、初期地図データ２２１を更新する（ステップＳ４０２）。その結果、更新された初期地図データ２２１では、更新情報を用いて更新された、層における道路区間と関連付けられている情報は、サーバ３において更新された地図データの情報と一致する。更新部３３は、例えば、更新情報が地図データの第１層のある道路区間と関連付けられた道路標示の位置及び種類の変化を示している場合、更新情報を用いて、初期地図データ２２１の第１層におけるそのある道路区間の情報を更新する。また、更新部３３は、例えば、更新情報が地図データの第２層のある道路区間と関連付けられた交通規制に関する情報の変化を示している場合、更新情報を用いて、初期地図データ２２１の第２層におけるそのある道路区間の情報を更新する。また、更新部３３は、例えば、更新情報が地図データの第３層のある道路区間と関連付けられた渋滞に関する情報の変化を示している場合、更新情報を用いて、初期地図データ２２１の第３層におけるそのある道路区間の情報を更新する。さらに、更新部３３は、例えば、更新情報が地図データの第４層のある道路区間と関連付けられた車両の位置及び種類に関する情報の変化を示している場合、更新情報を用いて、初期地図データ２２１の第４層におけるそのある道路区間の情報を更新する。一方、地図データの更新情報を受信していない場合（ステップＳ４０１−Ｎｏ）、更新部３３は、車両２が目的地に到着したか否かを判定する。更新部３３は、例えば、車両２の現在位置と、走行予定経路とに基づいて、車両２が目的地に到着したか否かを判定する。車両２が目的地に到着している場合（ステップＳ４０３−Ｙｅｓ）、地図データ記憶装置１４の動作は終了する。一方、車両２が目的地に到着している場合（ステップＳ４０３−Ｎｏ）、更新部３３は、所定の時間間隔をおいて、ステップＳ４０１の判定を実行する。
</p>
<p num="0052">
  地図情報生成部３４は、測位情報受信機１３から測位情報を入力する度に、ストレージ装置２２に記憶している初期地図データ２２１又は更新された初期地図データ２２１を参照して、測位情報により表される現在位置を含む相対的に狭い領域（例えば、１００ｍ〜１０ｋｍ四方の範囲）の地図情報、測位情報及び測位情報取得時刻を、車内ネットワークを介して車両制御装置１６へ出力する。また、地図情報記憶装置１４は、測位情報受信機１３から測位情報が入力される度に、測位情報及び測位情報取得時刻を、車内ネットワークを介してナビゲーション装置１５へ出力する。
</p>
<p num="0053">
  図１１は、サーバ３のハードウェア構成図である。サーバ３は、通信インターフェース４１と、ストレージ装置４２と、メモリ４３と、プロセッサ４４とを有する。通信インターフェース４１、ストレージ装置４２及びメモリ４３は、プロセッサ４４と信号線を介して接続されている。サーバ３は、キーボード及びマウスといった入力装置と、液晶ディスプレイといった表示装置とをさらに有してもよい。
</p>
<p num="0054">
  通信インターフェース４１は、通信部の一例であり、サーバ３を通信ネットワーク４に接続するためのインターフェース回路を有する。そして通信インターフェース４１は、車両２と、通信ネットワーク４及びマクロセル基地局５又はスモールセル基地局６を介して通信可能に構成される。すなわち、通信インターフェース４１は、車両２からマクロセル基地局５又はスモールセル基地局６及び通信ネットワーク４を介して受信した、地図データ要求、更新要求などをプロセッサ４４へわたす。また、通信インターフェース４１は、プロセッサ４４から受け取った地図データ、更新情報などを、通信ネットワーク４及びマクロセル基地局５又はスモールセル基地局６を介して車両２へ送信する。
</p>
<p num="0055">
  ストレージ装置４２は、記憶部の一例であり、例えば、ハードディスク装置又は光記録媒体及びそのアクセス装置を有する。そしてストレージ装置４２は、プロセッサ４４により更新される地図データなどを記憶する。地図データは、図３に示す階層構造を有する。サーバ３は、例えば通信ネットワーク４を介して道路に関する情報を収集し、地図データの各層の情報を更新する。例えば、サーバ３では、第１層を１時間ごとに更新し、第２層を３０分〜１時間ごとに更新し、第３層を３０分〜１分ごとに更新し、第４層を３０分〜１分ごとに更新する。また、ストレージ装置４２は、他のサーバなどにより更新された地図データを記憶していてもよい。ストレージ装置４２は、車両２の車両ＩＤをさらに記憶してもよい。さらに、ストレージ装置４２は、プロセッサ４４上で実行される、地図データ更新処理に関連するサーバ３の処理を実行するためのコンピュータプログラムを記憶してもよい。
</p>
<p num="0056">
  メモリ４３は、記憶部の他の一例であり、例えば、不揮発性の半導体メモリ及び揮発性の半導体メモリを有する。そしてメモリ４３は、地図データ更新処理のうちのサーバ３に関連する処理の実行中に生成される各種データ、並びに、更新要求及び更新情報といった車両２との通信により取得される各種データなどを一時的に記憶する。
</p>
<p num="0057">
  プロセッサ４４は、制御部の一例であり、１個又は複数個のＣＰＵ(Central Processing Unit)及びその周辺回路を有する。プロセッサ４４は、論理演算ユニットあるいは数値演算ユニットといった他の演算回路をさらに有していてもよい。そしてプロセッサ４４は、地図データ更新処理のうちのサーバ３に関連する処理を実行する。
</p>
<p num="0058">
  図１２は、サーバ３のプロセッサ４４の機能ブロック図である。プロセッサ４４は、地図データ送信部５１と、更新情報生成部５２と、地図データ更新部５３とを有する。プロセッサ４４が有するこれらの各部は、例えば、プロセッサ４４上で動作するコンピュータプログラムにより実現される機能モジュールである。あるいは、プロセッサ４４が有するこれらの各部は、プロセッサ４４に設けられる、専用の演算回路であってもよい。
</p>
<p num="0059">
  地図データ送信部５１は、車両２から地図データ要求を受信すると、ストレージ装置４２から地図データ４２１（基本データ及び更新データ）を読み出して、この地図データを、通信インターフェース４１を用いて、通信ネットワーク４及びマクロセル基地局５を介して車両２へ送信する。
</p>
<p num="0060">
  図１３は、地図データ更新処理のうちのサーバの更新情報生成部５２において実行される処理の動作フローチャートである。まず、更新情報生成部５２は、更新要求を受信したか否かを判定する（ステップＳ５０１）。更新要求を受信した場合（ステップＳ５０１−Ｙｅｓ）、更新情報生成部５２は、ストレージ装置４２に記憶される地図データ４２１を参照して、更新要求により特定される層の更新データのうち更新要求により特定される道路区間に関する情報のみを含む更新情報を生成する（ステップＳ５０２）。すなわち、この更新情報は、更新要求により特定される層以外の層の情報を含まず、且つ、更新要求により特定される層について、更新要求により特定される道路区間以外の道路区間に関する情報を含まない。次に、更新情報生成部５２は、この更新情報に対して、更新要求により特定される層を表す情報及び道路区間ＩＤを追加して、この更新情報を、通信インターフェース４１を用いて、通信ネットワーク４及びマクロセル基地局５又はスモールセル基地局６を介して車両２へ送信する（ステップＳ５０３）。
</p>
<p num="0061">
  地図データ更新部５３は、道路に関する情報を適宜収集して、ストレージ装置４２に記憶されている地図データ４２１を更新する。地図データ更新部５３は、通信インターフェース４１を介して、通信ネットワーク４を通して収集された道路に関する情報を層ごとに分類し、層ごとの更新周期において分類された情報を対応する層の車線ＩＤと関連づけるように、地図データ４２１の更新データを更新する。また、地図データ更新部５３は、各層の更新周期よりも長い更新周期で、更新データを用いて基本データを更新して、新たな基本データを生成する。
</p>
<p num="0062">
  以上に説明してきたように、この地図データ記憶装置は、車両が走行を開始する前にサーバから受信した地図データを、初期地図データとして記憶し、車両が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバにおいて更新された地図データにおける当該道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、サーバへ送信する。そして、この地図データ記憶装置は、受信した更新情報を用いて、初期地図データを更新する。これにより、地図データ記憶装置は、車両が走行を開始した後は、地図データにおける走行予定経路に含まれる道路区間と関連づけられている更新情報のみを受信することにより、走行予定経路と関係する地図データを新しい状態に更新すると共に、通信負荷及び通信費用を低減できる。
</p>
<p num="0063">
  次に、上述した地図データ更新システムの変型例を、以下に説明する。本変型例では、サーバ３において、地図データが有する複数の情報のそれぞれは、情報が更新された更新日時と関連付けられている。サーバ３は、地図データの更新に関連する処理を、地図データが有する複数の情報のそれぞれの更新日時を用いて実行する。サーバ３は、車両２から受信された地図データ要求に応じて、地図データと、この地図データを車両２へ送信した時刻を表す送信日時とを車両２へ送信する。車両２の地図データ更新装置のストレージ装置２２は、走行を開始する前に、サーバ３から受信された地図データを初期地図データとして記憶すると共に、サーバ３から受信された地図データの送信日時を、初期地図データの送信日時として記憶する。初期地図データと共に記憶する。そして、車両２地図データ更新装置の更新要求部は、地図データの更新情報をサーバ３へ要求する時に、道路区間ＩＤと、初期地図データの送信日時とを含む更新情報を、通信部を介してサーバへ送信する。これに応じて、サーバ３は、サーバ３において更新された地図データにおける道路区間と関連付けられている情報のうち、初期地図データの送信日時よりも後に更新された情報を含む更新情報を生成して、車両２へ送信する。車両２の地図データ更新装置の更新部は、走行予定経路に含まれる複数の道路区間のそれぞれのうち、更新情報を要求した道路区間について、道路区間について、サーバ３において更新された地図データにおける道路区間と関連付けられている情報のうち、初期地図データの送信日時よりも後に更新された情報を含む更新情報を用いて、初期地図データを更新する。なお、上述した地図データの更新処理は、地図データの層ごとに行われてもよい。
</p>
<p num="0064">
  本発明では、上述した実施形態の地図データ記憶装置及び地図データ更新用コンピュータプログラムは、本発明の趣旨を逸脱しない限り適宜変更が可能である。また、本発明の技術範囲はそれらの実施形態に限定されず、特許請求の範囲に記載された発明とその均等物に及ぶものである。
</p>
<p num="0065">
  例えば、本発明では、地図データ記憶装置は車両に搭載されていたが、地図データ記憶装置は、車両以外の移動物体に搭載されていてもよいし、携帯端末に搭載されていてもよい。
</p>
<p num="0066">
  また、上述した実施形態では、地図データは、第１層〜第４層を有していたが、地図データは、情報を第１層〜第４層に分類されていなくてもよい。この地図データの更新処理は、層ごとではなく、地図データの全体について行われてもよい。
</p>
</description-of-embodiments>
<reference-signs-list>
<p num="0067">
  １    地図データ更新システム<br/>
  ２    車両<br/>
  １１    カメラ<br/>
  １２    無線通信端末<br/>
  １３    測位情報受信機<br/>
  １４    地図データ記憶装置<br/>
  ２１    通信インターフェース<br/>
  ２２    ストレージ装置<br/>
  ２２１    地図データ<br/>
  ２３    メモリ<br/>
  ２４    プロセッサ<br/>
  ３１    地図データ取得部<br/>
  ３２    更新要求部<br/>
  ３３    更新部<br/>
  ３４    地図情報生成部<br/>
  １５    ナビゲーション装置<br/>
  １６    車両制御装置<br/>
  ３    サーバ<br/>
  ４１    通信インターフェース<br/>
  ４２    ストレージ装置<br/>
  ４２１    地図データ<br/>
  ４３    メモリ<br/>
  ４４    プロセッサ<br/>
  ５１    地図データ送信部<br/>
  ５２    更新情報生成部<br/>
  ５３    地図データ更新部<br/>
  ４    ネットワーク<br/>
  ５    マクロセル基地局<br/>
  ６    スモールセル基地局
</p>
</reference-signs-list>
</description><claims>
<claim num="1">
<claim-text>
  車両が走行を開始する前に通信部を介してサーバから受信した地図データを、初期地図データとして記憶する記憶部と、<br/>
  前記車両が走行予定経路に沿って走行を開始した後、前記走行予定経路に含まれる複数の道路区間のそれぞれについて、前記サーバにおいて更新された前記地図データにおける当該道路区間と関連付けられている情報のうち、前記初期地図データから更新された情報を表す更新情報の要求を、前記通信部を介して前記サーバへ送信する更新要求部と、<br/>
  前記通信部を介して受信した前記更新情報を用いて、前記初期地図データを更新する更新部と、<br/>
を有する地図データ更新装置。
</claim-text>
</claim>
<claim num="2">
<claim-text>
  前記地図データは、前記サーバにおいて第１の更新周期で情報が更新される第１地図データと、前記サーバにおいて前記第１の更新周期よりも短い第２の更新周期で情報が更新される第２地図データとを有し、<br/>
  前記更新要求部は、前記走行予定経路に含まれる複数の前記道路区間のそれぞれについて、前記車両が当該道路区間に到達する前に、当該道路区間と関連づけられている前記第１地図データの前記更新情報の要求を、前記第２地図データの前記更新情報よりも前に前記通信部を介して前記サーバへ送信する請求項１に記載の地図データ更新装置。
</claim-text>
</claim>
<claim num="3">
<claim-text>
  前記地図データは、基本データと、当該基本データに対して更新された情報を有する更新データとを有し、<br/>
  前記更新部は、前記走行予定経路に含まれる複数の前記道路区間のそれぞれのうち、前記更新情報を要求した当該道路区間について、前記サーバにおいて更新された前記更新データにおける前記道路区間と関連付けられている情報のうち、前記初期地図データから更新された情報を表す前記更新情報を用いて、前記初期地図データを更新する請求項１に記載の地図データ更新装置。
</claim-text>
</claim>
<claim num="4">
<claim-text>
  前記地図データが有する複数の情報のそれぞれは、当該情報が更新された更新日時と関連付けられており、<br/>
  前記記憶部は、前記サーバが前記地図データを前記車両に送信した送信日時を、前記初期地図データの送信日時として、前記初期地図データと共に記憶し、<br/>
  前記更新要求部は、前記初期地図データの前記送信日時を、前記更新情報の要求と共に、前記通信部を介して前記サーバへ送信し、<br/>
  前記更新部は、前記走行予定経路に含まれる複数の前記道路区間のそれぞれのうち、前記更新情報を要求した当該道路区間について、前記サーバにおいて更新された前記地図データにおける前記道路区間と関連付けられている情報のうち、前記初期地図データの前記送信日時よりも後に更新された情報を含む前記更新情報を用いて、前記初期地図データを更新する請求項１に記載の地図データ更新装置。
</claim-text>
</claim>
<claim num="5">
<claim-text>
  車両が走行を開始する前に通信部を介してサーバから受信した地図データを、初期地図データとして記憶部に記憶させ、<br/>
  前記車両が走行予定経路に沿って走行を開始した後、前記走行予定経路に含まれる前記複数の道路区間のそれぞれについて、前記サーバにおいて更新された前記地図データにおける当該道路区間と関連付けられている情報のうち、前記初期地図データから更新された情報を表す更新情報の要求を、前記通信部を介して前記サーバへ送信し、<br/>
  前記通信部を介して受信した前記更新情報を用いて、前記初期地図データを更新する、<br/>
ことをプロセッサに実行させる地図データ更新用コンピュータプログラム。
</claim-text>
</claim>
</claims><abstract>
  <p num="">【課題】走行予定経路と関係する地図データを新しい状態に更新すると共に、通信負荷を低減できる地図データ更新装置を提供する。<br/>【解決手段】地図データ更新装置は、車両が走行を開始する前に通信部を介してサーバから受信した地図データを、初期地図データとして記憶する記憶部２２と、車両が走行予定経路に沿って走行を開始した後、走行予定経路に含まれる複数の道路区間のそれぞれについて、サーバにおいて更新された地図データにおける道路区間と関連付けられている情報のうち、初期地図データから更新された情報を表す更新情報の要求を、通信部を介してサーバへ送信する更新要求部３２と、通信部を介して受信した更新情報を用いて、初期地図データを更新する更新部３３と、を有する。<br/>【選択図】図６</p>
</abstract><drawings>
<figure num="1">
<img id="000003" he="115" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="2">
<img id="000004" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="3">
<img id="000005" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="4">
<img id="000006" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="5">
<img id="000007" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="6">
<img id="000008" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="7">
<img id="000009" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="8">
<img id="000010" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="9">
<img id="000011" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="10">
<img id="000012" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="11">
<img id="000013" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="12">
<img id="000014" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
<figure num="13">
<img id="000015" he="118" wi="84" file="2021140113.tif" img-format="tif" img-content="drawing"/>
</figure>
</drawings><jp:overflow><p num="">(72)発明者  五十嵐  諒<br/>            東京都中央区日本橋室町三丁目２番１号  トヨタ・リサーチ・インスティテュート・アドバンスト<br/>            ・デベロップメント株式会社内<br/>Ｆターム(参考) 2C032 HB11  HB22  HC08 <br/>               2F129 AA03  BB03  DD13  DD15  DD21  EE02  EE52  EE78  EE79  FF02 <br/>                     FF20  FF30  FF39  FF62  FF63  FF65  GG17  GG18  HH20  HH24 <br/></p></jp:overflow></jp-official-gazette>
